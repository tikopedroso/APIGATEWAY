<!DOCTYPE html>
<html>
<head>
  <title>jakefile.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\ejs\\jakefile.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>jakefile.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span> execSync = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).execSync;
<span class="hljs-keyword">var</span> exec = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cmd</span>) </span>{
  execSync(cmd, {<span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span>});
};

<span class="hljs-comment">/* global jake, task, desc, publishTask */</span>

task(<span class="hljs-string">'build'</span>, [<span class="hljs-string">'lint'</span>, <span class="hljs-string">'clean'</span>, <span class="hljs-string">'browserify'</span>, <span class="hljs-string">'minify'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Build completed.'</span>);
});

desc(<span class="hljs-string">'Cleans browerified/minified files and package files'</span>);
task(<span class="hljs-string">'clean'</span>, [<span class="hljs-string">'clobber'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  jake.rmRf(<span class="hljs-string">'./ejs.js'</span>);
  jake.rmRf(<span class="hljs-string">'./ejs.min.js'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Cleaned up compiled files.'</span>);
});

desc(<span class="hljs-string">'Lints the source code'</span>);
task(<span class="hljs-string">'lint'</span>, [<span class="hljs-string">'clean'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  exec(<span class="hljs-string">'./node_modules/.bin/eslint "**/*.js"'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Linting completed.'</span>);
});

task(<span class="hljs-string">'browserify'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  exec(<span class="hljs-string">'./node_modules/browserify/bin/cmd.js --standalone ejs lib/ejs.js &gt; ejs.js'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Browserification completed.'</span>);
});

task(<span class="hljs-string">'minify'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  exec(<span class="hljs-string">'./node_modules/uglify-js/bin/uglifyjs ejs.js &gt; ejs.min.js'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Minification completed.'</span>);
});

desc(<span class="hljs-string">'Generates the EJS API docs'</span>);
task(<span class="hljs-string">'doc'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dev</span>) </span>{
  jake.rmRf(<span class="hljs-string">'out'</span>);
  <span class="hljs-keyword">var</span> p = dev ? <span class="hljs-string">'-p'</span> : <span class="hljs-string">''</span>;
  exec(<span class="hljs-string">'./node_modules/.bin/jsdoc '</span> + p + <span class="hljs-string">' -c jsdoc.json lib/* docs/jsdoc/*'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Documentation generated.'</span>);
});

desc(<span class="hljs-string">'Publishes the EJS API docs'</span>);
task(<span class="hljs-string">'docPublish'</span>, [<span class="hljs-string">'doc'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  fs.writeFileSync(<span class="hljs-string">'out/CNAME'</span>, <span class="hljs-string">'api.ejs.co'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Pushing docs to gh-pages...'</span>);
  exec(<span class="hljs-string">'./node_modules/.bin/git-directory-deploy --directory out/'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Docs published to gh-pages.'</span>);
});

desc(<span class="hljs-string">'Runs the EJS test suite'</span>);
task(<span class="hljs-string">'test'</span>, [<span class="hljs-string">'lint'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  exec(<span class="hljs-string">'./node_modules/.bin/mocha'</span>);
});

publishTask(<span class="hljs-string">'ejs'</span>, [<span class="hljs-string">'build'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.packageFiles.include([
    <span class="hljs-string">'jakefile.js'</span>,
    <span class="hljs-string">'README.md'</span>,
    <span class="hljs-string">'LICENSE'</span>,
    <span class="hljs-string">'package.json'</span>,
    <span class="hljs-string">'postinstall.js'</span>,
    <span class="hljs-string">'ejs.js'</span>,
    <span class="hljs-string">'ejs.min.js'</span>,
    <span class="hljs-string">'lib/**'</span>
  ]);
});

jake.Task.publish.on(<span class="hljs-string">'complete'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Updating hosted docs...'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'If this fails, run jake docPublish to re-try.'</span>);
  jake.Task.docPublish.invoke();
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
