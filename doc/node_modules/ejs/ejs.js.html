<!DOCTYPE html>
<html>
<head>
  <title>ejs.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\ejs\\ejs.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>ejs.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>)</span>{<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> exports===<span class="hljs-string">"object"</span>&amp;&amp;<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span>!==<span class="hljs-string">"undefined"</span>){<span class="hljs-built_in">module</span>.exports=f()}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> define===<span class="hljs-string">"function"</span>&amp;&amp;define.amd){define([],f)}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">var</span> g;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span>!==<span class="hljs-string">"undefined"</span>){g=<span class="hljs-built_in">window</span>}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> global!==<span class="hljs-string">"undefined"</span>){g=global}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> self!==<span class="hljs-string">"undefined"</span>){g=self}<span class="hljs-keyword">else</span>{g=<span class="hljs-keyword">this</span>}g.ejs = f()}})(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> define,<span class="hljs-built_in">module</span>,exports;<span class="hljs-keyword">return</span> (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">r</span>(<span class="hljs-params">e,n,t</span>)</span>{<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">o</span>(<span class="hljs-params">i,f</span>)</span>{<span class="hljs-keyword">if</span>(!n[i]){<span class="hljs-keyword">if</span>(!e[i]){<span class="hljs-keyword">var</span> c=<span class="hljs-string">"function"</span>==<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">require</span>&amp;&amp;<span class="hljs-built_in">require</span>;<span class="hljs-keyword">if</span>(!f&amp;&amp;c)<span class="hljs-keyword">return</span> c(i,!<span class="hljs-number">0</span>);<span class="hljs-keyword">if</span>(u)<span class="hljs-keyword">return</span> u(i,!<span class="hljs-number">0</span>);<span class="hljs-keyword">var</span> a=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Cannot find module '"</span>+i+<span class="hljs-string">"'"</span>);<span class="hljs-keyword">throw</span> a.code=<span class="hljs-string">"MODULE_NOT_FOUND"</span>,a}<span class="hljs-keyword">var</span> p=n[i]={<span class="hljs-attr">exports</span>:{}};e[i][<span class="hljs-number">0</span>].call(p.exports,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">r</span>)</span>{<span class="hljs-keyword">var</span> n=e[i][<span class="hljs-number">1</span>][r];<span class="hljs-keyword">return</span> o(n||r)},p,p.exports,r,e,n,t)}<span class="hljs-keyword">return</span> n[i].exports}<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> u=<span class="hljs-string">"function"</span>==<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">require</span>&amp;&amp;<span class="hljs-built_in">require</span>,i=<span class="hljs-number">0</span>;i&lt;t.length;i++)o(t[i]);<span class="hljs-keyword">return</span> o}<span class="hljs-keyword">return</span> r})()({<span class="hljs-number">1</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">require,module,exports</span>)</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>EJS Embedded JavaScript templates
Copyright 2112 Matthew Eernisse (mde@fleegix.org)</p>
</div>
<div class="body">
<p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<pre><code>    http://www.apache.org/licenses/LICENSE-2.0
</code></pre>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">
'use strict'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>EJS internal functions.</p>
</div>
<div class="body">
<p>Technically this &quot;module&quot; lies in the same file as {@link module:ejs}, for
the sake of organization all the private functions re grouped into this
module.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Embedded JavaScript templating engine.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>);

<span class="hljs-keyword">var</span> scopeOptionWarned = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">var</span> _VERSION_STRING = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../package.json'</span>).version;
<span class="hljs-keyword">var</span> _DEFAULT_OPEN_DELIMITER = <span class="hljs-string">'&lt;'</span>;
<span class="hljs-keyword">var</span> _DEFAULT_CLOSE_DELIMITER = <span class="hljs-string">'&gt;'</span>;
<span class="hljs-keyword">var</span> _DEFAULT_DELIMITER = <span class="hljs-string">'%'</span>;
<span class="hljs-keyword">var</span> _DEFAULT_LOCALS_NAME = <span class="hljs-string">'locals'</span>;
<span class="hljs-keyword">var</span> _NAME = <span class="hljs-string">'ejs'</span>;
<span class="hljs-keyword">var</span> _REGEX_STRING = <span class="hljs-string">'(&lt;%%|%%&gt;|&lt;%=|&lt;%-|&lt;%_|&lt;%#|&lt;%|%&gt;|-%&gt;|_%&gt;)'</span>;
<span class="hljs-keyword">var</span> _OPTS_PASSABLE_WITH_DATA = [<span class="hljs-string">'delimiter'</span>, <span class="hljs-string">'scope'</span>, <span class="hljs-string">'context'</span>, <span class="hljs-string">'debug'</span>, <span class="hljs-string">'compileDebug'</span>,
  <span class="hljs-string">'client'</span>, <span class="hljs-string">'_with'</span>, <span class="hljs-string">'rmWhitespace'</span>, <span class="hljs-string">'strict'</span>, <span class="hljs-string">'filename'</span>, <span class="hljs-string">'async'</span>];
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>We don't allow 'cache' option to be passed in the data obj for
the normal <code>render</code> call, but this is where Express 2 &amp; 3 put it
so we make an exception for <code>renderFile</code></p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> _OPTS_PASSABLE_WITH_DATA_EXPRESS = _OPTS_PASSABLE_WITH_DATA.concat(<span class="hljs-string">'cache'</span>);
<span class="hljs-keyword">var</span> _BOM = <span class="hljs-regexp">/^\uFEFF/</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>EJS template function cache. This can be a LRU object from lru-cache NPM
module. By default, it is {@link module:utils.cache}, a simple in-process
cache that grows continuously.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Type</div>
<div class="dox_tag_detail">
<span class="dox_type">Cache</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.cache = utils.cache;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<p>Custom file loader. Useful for template preprocessing or restricting access
to a certain part of the filesystem.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Type</div>
<div class="dox_tag_detail">
<span class="dox_type">fileLoader</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.fileLoader = fs.readFileSync;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>Name of the object containing the locals.</p>
</div>
<div class="body">
<p>This variable is overridden by {@link Options}<code>.localsName</code> if it is not
<code>undefined</code>.</p>
</div>
<div class="details">
<div class="dox_tag_title">Type</div>
<div class="dox_tag_detail">
<span class="dox_type">String</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.localsName = _DEFAULT_LOCALS_NAME;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
<p>Promise implementation -- defaults to the native implementation if available
This is mostly just for testability</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Type</div>
<div class="dox_tag_detail">
<span class="dox_type">Function</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.promiseImpl = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(<span class="hljs-string">'return this;'</span>))().Promise;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get the path to the included file from the parent file path and the
specified path.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">name</span>
<span class="dox_type">String</span>
<span>specified path
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">filename</span>
<span class="dox_type">String</span>
<span>parent file path
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">isDir</span>
<span class="dox_type">Boolean</span>
<span>parent file path whether is directory
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">String</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.resolveInclude = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, filename, isDir</span>) </span>{
  <span class="hljs-keyword">var</span> dirname = path.dirname;
  <span class="hljs-keyword">var</span> extname = path.extname;
  <span class="hljs-keyword">var</span> resolve = path.resolve;
  <span class="hljs-keyword">var</span> includePath = resolve(isDir ? filename : dirname(filename), name);
  <span class="hljs-keyword">var</span> ext = extname(name);
  <span class="hljs-keyword">if</span> (!ext) {
    includePath += <span class="hljs-string">'.ejs'</span>;
  }
  <span class="hljs-keyword">return</span> includePath;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get the path to the included file by Options</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
<span>specified path
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">Options</span>
<span>compilation options
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">String</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getIncludePath</span>(<span class="hljs-params">path, options</span>) </span>{
  <span class="hljs-keyword">var</span> includePath;
  <span class="hljs-keyword">var</span> filePath;
  <span class="hljs-keyword">var</span> views = options.views;
  <span class="hljs-keyword">var</span> match = <span class="hljs-regexp">/^[A-Za-z]+:\\|^\//</span>.exec(path);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>Abs path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (match &amp;&amp; match.length) {
    includePath = exports.resolveInclude(path.replace(<span class="hljs-regexp">/^\/*/</span>,<span class="hljs-string">''</span>), options.root || <span class="hljs-string">'/'</span>, <span class="hljs-literal">true</span>);
  }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Relative paths</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Look relative to a passed filename first</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (options.filename) {
      filePath = exports.resolveInclude(path, options.filename);
      <span class="hljs-keyword">if</span> (fs.existsSync(filePath)) {
        includePath = filePath;
      }
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>Then look in any views directories</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!includePath) {
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(views) &amp;&amp; views.some(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) </span>{
        filePath = exports.resolveInclude(path, v, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">return</span> fs.existsSync(filePath);
      })) {
        includePath = filePath;
      }
    }
    <span class="hljs-keyword">if</span> (!includePath) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Could not find the include file "'</span> +
          options.escapeFunction(path) + <span class="hljs-string">'"'</span>);
    }
  }
  <span class="hljs-keyword">return</span> includePath;
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get the template from a string or a file, either compiled on-the-fly or
read from cache (if enabled), and cache the template if needed.</p>
</div>
<div class="body">
<p>If <code>template</code> is not set, the file specified in <code>options.filename</code> will be
read.</p>
<p>If <code>options.cache</code> is true, this function reads the file from
<code>options.filename</code> so it must be set prior to calling this function.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">Options</span>
<span>compilation options
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[template]</span>
<span class="dox_type">String</span>
<span>template source
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">TemplateFunction</span>
<span class="dox_type">ClientFunction</span>
<span>Depending on the value of <code>options.client</code>, either type might be returned.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleCache</span>(<span class="hljs-params">options, template</span>) </span>{
  <span class="hljs-keyword">var</span> func;
  <span class="hljs-keyword">var</span> filename = options.filename;
  <span class="hljs-keyword">var</span> hasTemplate = <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span>;

  <span class="hljs-keyword">if</span> (options.cache) {
    <span class="hljs-keyword">if</span> (!filename) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'cache option requires a filename'</span>);
    }
    func = exports.cache.get(filename);
    <span class="hljs-keyword">if</span> (func) {
      <span class="hljs-keyword">return</span> func;
    }
    <span class="hljs-keyword">if</span> (!hasTemplate) {
      template = fileLoader(filename).toString().replace(_BOM, <span class="hljs-string">''</span>);
    }
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!hasTemplate) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>istanbul ignore if: should not happen at all</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!filename) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Internal EJS error: no file name or template '</span>
                    + <span class="hljs-string">'provided'</span>);
    }
    template = fileLoader(filename).toString().replace(_BOM, <span class="hljs-string">''</span>);
  }
  func = exports.compile(template, options);
  <span class="hljs-keyword">if</span> (options.cache) {
    exports.cache.set(filename, func);
  }
  <span class="hljs-keyword">return</span> func;
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<div class="dox">
<div class="summary">
<p>Try calling handleCache with the given options and data and call the
callback with the result. If an error occurs, call the callback with
the error. Used by renderFile().</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">Options</span>
<span>compilation options
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">data</span>
<span class="dox_type">Object</span>
<span>template data
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">cb</span>
<span class="dox_type">RenderFileCallback</span>
<span>callback
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tryHandleCache</span>(<span class="hljs-params">options, data, cb</span>) </span>{
  <span class="hljs-keyword">var</span> result;
  <span class="hljs-keyword">if</span> (!cb) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports.promiseImpl == <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> exports.promiseImpl(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>{
        <span class="hljs-keyword">try</span> {
          result = handleCache(options)(data);
          resolve(result);
        }
        <span class="hljs-keyword">catch</span> (err) {
          reject(err);
        }
      });
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Please provide a callback function'</span>);
    }
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">try</span> {
      result = handleCache(options)(data);
    }
    <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-keyword">return</span> cb(err);
    }

    cb(<span class="hljs-literal">null</span>, result);
  }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<div class="dox">
<div class="summary">
<p>fileLoader is independent</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">filePath</span>
<span class="dox_type">String</span>
<span>ejs file path.
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">String</span>
<span>The contents of the specified file.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fileLoader</span>(<span class="hljs-params">filePath</span>)</span>{
  <span class="hljs-keyword">return</span> exports.fileLoader(filePath);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get the template function.</p>
</div>
<div class="body">
<p>If <code>options.cache</code> is <code>true</code>, then the template is cached.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
<span>path for the specified file
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">Options</span>
<span>compilation options
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">TemplateFunction</span>
<span class="dox_type">ClientFunction</span>
<span>Depending on the value of <code>options.client</code>, either type might be returned
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">includeFile</span>(<span class="hljs-params">path, options</span>) </span>{
  <span class="hljs-keyword">var</span> opts = utils.shallowCopy({}, options);
  opts.filename = getIncludePath(path, opts);
  <span class="hljs-keyword">return</span> handleCache(opts);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get the JavaScript source of an included file.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
<span>path for the specified file
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">Options</span>
<span>compilation options
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">includeSource</span>(<span class="hljs-params">path, options</span>) </span>{
  <span class="hljs-keyword">var</span> opts = utils.shallowCopy({}, options);
  <span class="hljs-keyword">var</span> includePath;
  <span class="hljs-keyword">var</span> template;
  includePath = getIncludePath(path, opts);
  template = fileLoader(includePath).toString().replace(_BOM, <span class="hljs-string">''</span>);
  opts.filename = includePath;
  <span class="hljs-keyword">var</span> templ = <span class="hljs-keyword">new</span> Template(template, opts);
  templ.generateSource();
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">source</span>: templ.source,
    <span class="hljs-attr">filename</span>: includePath,
    <span class="hljs-attr">template</span>: template
  };
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<div class="dox">
<div class="summary">
<p>Re-throw the given <code>err</code> in context to the <code>str</code> of ejs, <code>filename</code>, and
<code>lineno</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">err</span>
<span class="dox_type">Error</span>
<span>Error object
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">str</span>
<span class="dox_type">String</span>
<span>EJS source
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">filename</span>
<span class="dox_type">String</span>
<span>file name of the EJS file
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">lineno</span>
<span class="dox_type">String</span>
<span>line number of the error
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rethrow</span>(<span class="hljs-params">err, str, flnm, lineno, esc</span>)</span>{
  <span class="hljs-keyword">var</span> lines = str.split(<span class="hljs-string">'\n'</span>);
  <span class="hljs-keyword">var</span> start = <span class="hljs-built_in">Math</span>.max(lineno - <span class="hljs-number">3</span>, <span class="hljs-number">0</span>);
  <span class="hljs-keyword">var</span> end = <span class="hljs-built_in">Math</span>.min(lines.length, lineno + <span class="hljs-number">3</span>);
  <span class="hljs-keyword">var</span> filename = esc(flnm); <span class="hljs-comment">// eslint-disable-line</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>Error context</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> context = lines.slice(start, end).map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">line, i</span>)</span>{
    <span class="hljs-keyword">var</span> curr = i + start + <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> (curr == lineno ? <span class="hljs-string">' &gt;&gt; '</span> : <span class="hljs-string">'    '</span>)
      + curr
      + <span class="hljs-string">'| '</span>
      + line;
  }).join(<span class="hljs-string">'\n'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>Alter exception message</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  err.path = filename;
  err.message = (filename || <span class="hljs-string">'ejs'</span>) + <span class="hljs-string">':'</span>
    + lineno + <span class="hljs-string">'\n'</span>
    + context + <span class="hljs-string">'\n\n'</span>
    + err.message;

  <span class="hljs-keyword">throw</span> err;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stripSemi</span>(<span class="hljs-params">str</span>)</span>{
  <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/;(\s*$)/</span>, <span class="hljs-string">'$1'</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<div class="dox">
<div class="summary">
<p>Compile the given <code>str</code> of ejs into a template function.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">template</span>
<span class="dox_type">String</span>
<span>EJS template
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opts</span>
<span class="dox_type">Options</span>
<span>compilation options
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">TemplateFunction</span>
<span class="dox_type">ClientFunction</span>
<span>Depending on the value of <code>opts.client</code>, either type might be returned.
Note that the return type of the function also depends on the value of <code>opts.async</code>.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.compile = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compile</span>(<span class="hljs-params">template, opts</span>) </span>{
  <span class="hljs-keyword">var</span> templ;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>v1 compat
'scope' is 'context'
FIXME: Remove this in a future version</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (opts &amp;&amp; opts.scope) {
    <span class="hljs-keyword">if</span> (!scopeOptionWarned){
      <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">'`scope` option is deprecated and will be removed in EJS 3'</span>);
      scopeOptionWarned = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">if</span> (!opts.context) {
      opts.context = opts.scope;
    }
    <span class="hljs-keyword">delete</span> opts.scope;
  }
  templ = <span class="hljs-keyword">new</span> Template(template, opts);
  <span class="hljs-keyword">return</span> templ.compile();
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<div class="dox">
<div class="summary">
<p>Render the given <code>template</code> of ejs.</p>
</div>
<div class="body">
<p>If you would like to include options but not data, you need to explicitly
call this function with <code>data</code> being an empty object or <code>null</code>.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">template</span>
<span class="dox_type">String</span>
<span>EJS template
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[data={}]</span>
<span class="dox_type">Object</span>
<span>template data
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[opts={}]</span>
<span class="dox_type">Options</span>
<span>compilation and rendering options
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">String</span>
<span class="dox_type">Promise.&lt;String&gt;</span>
<span>Return value type depends on <code>opts.async</code>.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.render = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">template, d, o</span>) </span>{
  <span class="hljs-keyword">var</span> data = d || {};
  <span class="hljs-keyword">var</span> opts = o || {};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>No options object -- if there are optiony names
in the data, copy them to options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length == <span class="hljs-number">2</span>) {
    utils.shallowCopyFromList(opts, data, _OPTS_PASSABLE_WITH_DATA);
  }

  <span class="hljs-keyword">return</span> handleCache(opts, template)(data);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<div class="dox">
<div class="summary">
<p>Render an EJS file at the given <code>path</code> and callback <code>cb(err, str)</code>.</p>
</div>
<div class="body">
<p>If you would like to include options but not data, you need to explicitly
call this function with <code>data</code> being an empty object or <code>null</code>.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
<span>path to the EJS file
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[data={}]</span>
<span class="dox_type">Object</span>
<span>template data
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[opts={}]</span>
<span class="dox_type">Options</span>
<span>compilation and rendering options
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">cb</span>
<span class="dox_type">RenderFileCallback</span>
<span>callback
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.renderFile = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
  <span class="hljs-keyword">var</span> filename = args.shift();
  <span class="hljs-keyword">var</span> cb;
  <span class="hljs-keyword">var</span> opts = {<span class="hljs-attr">filename</span>: filename};
  <span class="hljs-keyword">var</span> data;
  <span class="hljs-keyword">var</span> viewOpts;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>Do we have a callback?</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">arguments</span>[<span class="hljs-built_in">arguments</span>.length - <span class="hljs-number">1</span>] == <span class="hljs-string">'function'</span>) {
    cb = args.pop();
  }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Do we have data/opts?</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (args.length) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>Should always have data obj</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    data = args.shift();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>Normal passed opts (data obj + opts obj)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (args.length) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>Use shallowCopy so we don't pollute passed in opts obj with new vals</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      utils.shallowCopy(opts, args.pop());
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>Special casing for Express (settings + opts-in-data)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>Express 3 and 4</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (data.settings) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>Pull a few things from known locations</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (data.settings.views) {
          opts.views = data.settings.views;
        }
        <span class="hljs-keyword">if</span> (data.settings[<span class="hljs-string">'view cache'</span>]) {
          opts.cache = <span class="hljs-literal">true</span>;
        }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>Undocumented after Express 2, but still usable, esp. for
items that are unsafe to be passed along with data, like <code>root</code></p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        viewOpts = data.settings[<span class="hljs-string">'view options'</span>];
        <span class="hljs-keyword">if</span> (viewOpts) {
          utils.shallowCopy(opts, viewOpts);
        }
      }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>Express 2 and lower, values set in app.locals, or people who just
want to pass options in their data. NOTE: These values will override
anything previously set in settings  or settings['view options']</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      utils.shallowCopyFromList(opts, data, _OPTS_PASSABLE_WITH_DATA_EXPRESS);
    }
    opts.filename = filename;
  }
  <span class="hljs-keyword">else</span> {
    data = {};
  }

  <span class="hljs-keyword">return</span> tryHandleCache(opts, data, cb);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<div class="dox">
<div class="summary">
<p>Clear intermediate JavaScript cache. Calls {@link Cache#reset}.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<div class="dox">
<div class="summary">
<p>EJS template class</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.Template = Template;

exports.clearCache = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  exports.cache.reset();
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Template</span>(<span class="hljs-params">text, opts</span>) </span>{
  opts = opts || {};
  <span class="hljs-keyword">var</span> options = {};
  <span class="hljs-keyword">this</span>.templateText = text;
  <span class="hljs-keyword">this</span>.mode = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.truncate = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">this</span>.currentLine = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">this</span>.source = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">this</span>.dependencies = [];
  options.client = opts.client || <span class="hljs-literal">false</span>;
  options.escapeFunction = opts.escape || opts.escapeFunction || utils.escapeXML;
  options.compileDebug = opts.compileDebug !== <span class="hljs-literal">false</span>;
  options.debug = !!opts.debug;
  options.filename = opts.filename;
  options.openDelimiter = opts.openDelimiter || exports.openDelimiter || _DEFAULT_OPEN_DELIMITER;
  options.closeDelimiter = opts.closeDelimiter || exports.closeDelimiter || _DEFAULT_CLOSE_DELIMITER;
  options.delimiter = opts.delimiter || exports.delimiter || _DEFAULT_DELIMITER;
  options.strict = opts.strict || <span class="hljs-literal">false</span>;
  options.context = opts.context;
  options.cache = opts.cache || <span class="hljs-literal">false</span>;
  options.rmWhitespace = opts.rmWhitespace;
  options.root = opts.root;
  options.outputFunctionName = opts.outputFunctionName;
  options.localsName = opts.localsName || exports.localsName || _DEFAULT_LOCALS_NAME;
  options.views = opts.views;
  options.async = opts.async;
  options.destructuredLocals = opts.destructuredLocals;
  options.legacyInclude = <span class="hljs-keyword">typeof</span> opts.legacyInclude != <span class="hljs-string">'undefined'</span> ? !!opts.legacyInclude : <span class="hljs-literal">true</span>;

  <span class="hljs-keyword">if</span> (options.strict) {
    options._with = <span class="hljs-literal">false</span>;
  }
  <span class="hljs-keyword">else</span> {
    options._with = <span class="hljs-keyword">typeof</span> opts._with != <span class="hljs-string">'undefined'</span> ? opts._with : <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">this</span>.opts = options;

  <span class="hljs-keyword">this</span>.regex = <span class="hljs-keyword">this</span>.createRegex();
}

Template.modes = {
  <span class="hljs-attr">EVAL</span>: <span class="hljs-string">'eval'</span>,
  <span class="hljs-attr">ESCAPED</span>: <span class="hljs-string">'escaped'</span>,
  <span class="hljs-attr">RAW</span>: <span class="hljs-string">'raw'</span>,
  <span class="hljs-attr">COMMENT</span>: <span class="hljs-string">'comment'</span>,
  <span class="hljs-attr">LITERAL</span>: <span class="hljs-string">'literal'</span>
};

Template.prototype = {
  <span class="hljs-attr">createRegex</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> str = _REGEX_STRING;
    <span class="hljs-keyword">var</span> delim = utils.escapeRegExpChars(<span class="hljs-keyword">this</span>.opts.delimiter);
    <span class="hljs-keyword">var</span> open = utils.escapeRegExpChars(<span class="hljs-keyword">this</span>.opts.openDelimiter);
    <span class="hljs-keyword">var</span> close = utils.escapeRegExpChars(<span class="hljs-keyword">this</span>.opts.closeDelimiter);
    str = str.replace(<span class="hljs-regexp">/%/g</span>, delim)
      .replace(<span class="hljs-regexp">/&lt;/g</span>, open)
      .replace(<span class="hljs-regexp">/&gt;/g</span>, close);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(str);
  },

  <span class="hljs-attr">compile</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> src;
    <span class="hljs-keyword">var</span> fn;
    <span class="hljs-keyword">var</span> opts = <span class="hljs-keyword">this</span>.opts;
    <span class="hljs-keyword">var</span> prepended = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">var</span> appended = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">var</span> escapeFn = opts.escapeFunction;
    <span class="hljs-keyword">var</span> ctor;

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.source) {
      <span class="hljs-keyword">this</span>.generateSource();
      prepended +=
        <span class="hljs-string">'  var __output = "";\n'</span> +
        <span class="hljs-string">'  function __append(s) { if (s !== undefined &amp;&amp; s !== null) __output += s }\n'</span>;
      <span class="hljs-keyword">if</span> (opts.outputFunctionName) {
        prepended += <span class="hljs-string">'  var '</span> + opts.outputFunctionName + <span class="hljs-string">' = __append;'</span> + <span class="hljs-string">'\n'</span>;
      }
      <span class="hljs-keyword">if</span> (opts.destructuredLocals &amp;&amp; opts.destructuredLocals.length) {
        <span class="hljs-keyword">var</span> destructuring = <span class="hljs-string">'  var __locals = ('</span> + opts.localsName + <span class="hljs-string">' || {}),\n'</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; opts.destructuredLocals.length; i++) {
          <span class="hljs-keyword">var</span> name = opts.destructuredLocals[i];
          <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) {
            destructuring += <span class="hljs-string">',\n  '</span>;
          }
          destructuring += name + <span class="hljs-string">' = __locals.'</span> + name;
        }
        prepended += destructuring + <span class="hljs-string">';\n'</span>;
      }
      <span class="hljs-keyword">if</span> (opts._with !== <span class="hljs-literal">false</span>) {
        prepended +=  <span class="hljs-string">'  with ('</span> + opts.localsName + <span class="hljs-string">' || {}) {'</span> + <span class="hljs-string">'\n'</span>;
        appended += <span class="hljs-string">'  }'</span> + <span class="hljs-string">'\n'</span>;
      }
      appended += <span class="hljs-string">'  return __output;'</span> + <span class="hljs-string">'\n'</span>;
      <span class="hljs-keyword">this</span>.source = prepended + <span class="hljs-keyword">this</span>.source + appended;
    }

    <span class="hljs-keyword">if</span> (opts.compileDebug) {
      src = <span class="hljs-string">'var __line = 1'</span> + <span class="hljs-string">'\n'</span>
        + <span class="hljs-string">'  , __lines = '</span> + <span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-keyword">this</span>.templateText) + <span class="hljs-string">'\n'</span>
        + <span class="hljs-string">'  , __filename = '</span> + (opts.filename ?
        <span class="hljs-built_in">JSON</span>.stringify(opts.filename) : <span class="hljs-string">'undefined'</span>) + <span class="hljs-string">';'</span> + <span class="hljs-string">'\n'</span>
        + <span class="hljs-string">'try {'</span> + <span class="hljs-string">'\n'</span>
        + <span class="hljs-keyword">this</span>.source
        + <span class="hljs-string">'} catch (e) {'</span> + <span class="hljs-string">'\n'</span>
        + <span class="hljs-string">'  rethrow(e, __lines, __filename, __line, escapeFn);'</span> + <span class="hljs-string">'\n'</span>
        + <span class="hljs-string">'}'</span> + <span class="hljs-string">'\n'</span>;
    }
    <span class="hljs-keyword">else</span> {
      src = <span class="hljs-keyword">this</span>.source;
    }

    <span class="hljs-keyword">if</span> (opts.client) {
      src = <span class="hljs-string">'escapeFn = escapeFn || '</span> + escapeFn.toString() + <span class="hljs-string">';'</span> + <span class="hljs-string">'\n'</span> + src;
      <span class="hljs-keyword">if</span> (opts.compileDebug) {
        src = <span class="hljs-string">'rethrow = rethrow || '</span> + rethrow.toString() + <span class="hljs-string">';'</span> + <span class="hljs-string">'\n'</span> + src;
      }
    }

    <span class="hljs-keyword">if</span> (opts.strict) {
      src = <span class="hljs-string">'"use strict";\n'</span> + src;
    }
    <span class="hljs-keyword">if</span> (opts.debug) {
      <span class="hljs-built_in">console</span>.log(src);
    }
    <span class="hljs-keyword">if</span> (opts.compileDebug &amp;&amp; opts.filename) {
      src = src + <span class="hljs-string">'\n'</span>
        + <span class="hljs-string">'//# sourceURL='</span> + opts.filename + <span class="hljs-string">'\n'</span>;
    }

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (opts.async) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>Have to use generated function for this, since in envs without support,
it breaks in parsing</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">try</span> {
          ctor = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(<span class="hljs-string">'return (async function(){}).constructor;'</span>))();
        }
        <span class="hljs-keyword">catch</span>(e) {
          <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">SyntaxError</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'This environment does not support async/await'</span>);
          }
          <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> e;
          }
        }
      }
      <span class="hljs-keyword">else</span> {
        ctor = <span class="hljs-built_in">Function</span>;
      }
      fn = <span class="hljs-keyword">new</span> ctor(opts.localsName + <span class="hljs-string">', escapeFn, include, rethrow'</span>, src);
    }
    <span class="hljs-keyword">catch</span>(e) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>istanbul ignore else</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">SyntaxError</span>) {
        <span class="hljs-keyword">if</span> (opts.filename) {
          e.message += <span class="hljs-string">' in '</span> + opts.filename;
        }
        e.message += <span class="hljs-string">' while compiling ejs\n\n'</span>;
        e.message += <span class="hljs-string">'If the above error is not helpful, you may want to try EJS-Lint:\n'</span>;
        e.message += <span class="hljs-string">'https://github.com/RyanZim/EJS-Lint'</span>;
        <span class="hljs-keyword">if</span> (!opts.async) {
          e.message += <span class="hljs-string">'\n'</span>;
          e.message += <span class="hljs-string">'Or, if you meant to create an async function, pass `async: true` as an option.'</span>;
        }
      }
      <span class="hljs-keyword">throw</span> e;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<p>Return a callable function which will execute the function
created by the source-code, with the passed data as locals
Adds a local <code>include</code> function which allows full recursive include</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> returnedFn = opts.client ? fn : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">anonymous</span>(<span class="hljs-params">data</span>) </span>{
      <span class="hljs-keyword">var</span> include = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path, includeData</span>) </span>{
        <span class="hljs-keyword">var</span> d = utils.shallowCopy({}, data);
        <span class="hljs-keyword">if</span> (includeData) {
          d = utils.shallowCopy(d, includeData);
        }
        <span class="hljs-keyword">return</span> includeFile(path, opts)(d);
      };
      <span class="hljs-keyword">return</span> fn.apply(opts.context, [data || {}, escapeFn, include, rethrow]);
    };
    returnedFn.dependencies = <span class="hljs-keyword">this</span>.dependencies;
    <span class="hljs-keyword">if</span> (opts.filename &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Object</span>.defineProperty === <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">var</span> filename = opts.filename;
      <span class="hljs-keyword">var</span> basename = path.basename(filename, path.extname(filename));
      <span class="hljs-keyword">try</span> {
        <span class="hljs-built_in">Object</span>.defineProperty(returnedFn, <span class="hljs-string">'name'</span>, {
          <span class="hljs-attr">value</span>: basename,
          <span class="hljs-attr">writable</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
        });
      } <span class="hljs-keyword">catch</span> (e) {<span class="hljs-comment">/* ignore */</span>}
    }
    <span class="hljs-keyword">return</span> returnedFn;
  },

  <span class="hljs-attr">generateSource</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> opts = <span class="hljs-keyword">this</span>.opts;

    <span class="hljs-keyword">if</span> (opts.rmWhitespace) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>Have to use two separate replace here as <code>^</code> and <code>$</code> operators don't
work well with <code>\r</code> and empty lines don't work well with the <code>m</code> flag.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">this</span>.templateText =
        <span class="hljs-keyword">this</span>.templateText.replace(<span class="hljs-regexp">/[\r\n]+/g</span>, <span class="hljs-string">'\n'</span>).replace(<span class="hljs-regexp">/^\s+|\s+$/gm</span>, <span class="hljs-string">''</span>);
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>Slurp spaces and tabs before &lt;%_ and after _%&gt;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.templateText =
      <span class="hljs-keyword">this</span>.templateText.replace(<span class="hljs-regexp">/[ \t]*&lt;%_/gm</span>, <span class="hljs-string">'&lt;%_'</span>).replace(<span class="hljs-regexp">/_%&gt;[ \t]*/gm</span>, <span class="hljs-string">'_%&gt;'</span>);

    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> matches = <span class="hljs-keyword">this</span>.parseTemplateText();
    <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">this</span>.opts.delimiter;
    <span class="hljs-keyword">var</span> o = <span class="hljs-keyword">this</span>.opts.openDelimiter;
    <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.opts.closeDelimiter;

    <span class="hljs-keyword">if</span> (matches &amp;&amp; matches.length) {
      matches.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">line, index</span>) </span>{
        <span class="hljs-keyword">var</span> opening;
        <span class="hljs-keyword">var</span> closing;
        <span class="hljs-keyword">var</span> include;
        <span class="hljs-keyword">var</span> includeOpts;
        <span class="hljs-keyword">var</span> includeObj;
        <span class="hljs-keyword">var</span> includeSrc;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<p>If this is an opening tag, check for closing tags
FIXME: May end up with some false positives here
Better to store modes as k/v with openDelimiter + delimiter as key
Then this can simply check against the map</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> ( line.indexOf(o + d) === <span class="hljs-number">0</span>        <span class="hljs-comment">// If it is a tag</span>
          &amp;&amp; line.indexOf(o + d + d) !== <span class="hljs-number">0</span>) { <span class="hljs-comment">// and is not escaped</span>
          closing = matches[index + <span class="hljs-number">2</span>];
          <span class="hljs-keyword">if</span> (!(closing == d + c || closing == <span class="hljs-string">'-'</span> + d + c || closing == <span class="hljs-string">'_'</span> + d + c)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Could not find matching close tag for "'</span> + line + <span class="hljs-string">'".'</span>);
          }
        }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<p>HACK: backward-compat <code>include</code> preprocessor directives</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (opts.legacyInclude &amp;&amp; (include = line.match(<span class="hljs-regexp">/^\s*include\s+(\S+)/</span>))) {
          opening = matches[index - <span class="hljs-number">1</span>];
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<p>Must be in EVAL or RAW mode</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          <span class="hljs-keyword">if</span> (opening &amp;&amp; (opening == o + d || opening == o + d + <span class="hljs-string">'-'</span> || opening == o + d + <span class="hljs-string">'_'</span>)) {
            includeOpts = utils.shallowCopy({}, self.opts);
            includeObj = includeSource(include[<span class="hljs-number">1</span>], includeOpts);
            <span class="hljs-keyword">if</span> (self.opts.compileDebug) {
              includeSrc =
                  <span class="hljs-string">'    ; (function(){'</span> + <span class="hljs-string">'\n'</span>
                  + <span class="hljs-string">'      var __line = 1'</span> + <span class="hljs-string">'\n'</span>
                  + <span class="hljs-string">'      , __lines = '</span> + <span class="hljs-built_in">JSON</span>.stringify(includeObj.template) + <span class="hljs-string">'\n'</span>
                  + <span class="hljs-string">'      , __filename = '</span> + <span class="hljs-built_in">JSON</span>.stringify(includeObj.filename) + <span class="hljs-string">';'</span> + <span class="hljs-string">'\n'</span>
                  + <span class="hljs-string">'      try {'</span> + <span class="hljs-string">'\n'</span>
                  + includeObj.source
                  + <span class="hljs-string">'      } catch (e) {'</span> + <span class="hljs-string">'\n'</span>
                  + <span class="hljs-string">'        rethrow(e, __lines, __filename, __line, escapeFn);'</span> + <span class="hljs-string">'\n'</span>
                  + <span class="hljs-string">'      }'</span> + <span class="hljs-string">'\n'</span>
                  + <span class="hljs-string">'    ; }).call(this)'</span> + <span class="hljs-string">'\n'</span>;
            }<span class="hljs-keyword">else</span>{
              includeSrc = <span class="hljs-string">'    ; (function(){'</span> + <span class="hljs-string">'\n'</span> + includeObj.source +
                  <span class="hljs-string">'    ; }).call(this)'</span> + <span class="hljs-string">'\n'</span>;
            }
            self.source += includeSrc;
            self.dependencies.push(exports.resolveInclude(include[<span class="hljs-number">1</span>],
              includeOpts.filename));
            <span class="hljs-keyword">return</span>;
          }
        }
        self.scanLine(line);
      });
    }

  },

  <span class="hljs-attr">parseTemplateText</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> str = <span class="hljs-keyword">this</span>.templateText;
    <span class="hljs-keyword">var</span> pat = <span class="hljs-keyword">this</span>.regex;
    <span class="hljs-keyword">var</span> result = pat.exec(str);
    <span class="hljs-keyword">var</span> arr = [];
    <span class="hljs-keyword">var</span> firstPos;

    <span class="hljs-keyword">while</span> (result) {
      firstPos = result.index;

      <span class="hljs-keyword">if</span> (firstPos !== <span class="hljs-number">0</span>) {
        arr.push(str.substring(<span class="hljs-number">0</span>, firstPos));
        str = str.slice(firstPos);
      }

      arr.push(result[<span class="hljs-number">0</span>]);
      str = str.slice(result[<span class="hljs-number">0</span>].length);
      result = pat.exec(str);
    }

    <span class="hljs-keyword">if</span> (str) {
      arr.push(str);
    }

    <span class="hljs-keyword">return</span> arr;
  },

  <span class="hljs-attr">_addOutput</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">line</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.truncate) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<p>Only replace single leading linebreak in the line after
-%&gt; tag -- this is the single, trailing linebreak
after the tag that the truncation mode replaces
Handle Win / Unix / old Mac linebreaks -- do the \r\n
combo first in the regex-or</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      line = line.replace(<span class="hljs-regexp">/^(?:\r\n|\r|\n)/</span>, <span class="hljs-string">''</span>);
      <span class="hljs-keyword">this</span>.truncate = <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">if</span> (!line) {
      <span class="hljs-keyword">return</span> line;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52"></a>
</div>
<p>Preserve literal slashes</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    line = line.replace(<span class="hljs-regexp">/\\/g</span>, <span class="hljs-string">'\\\\'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<p>Convert linebreaks</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    line = line.replace(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">'\\n'</span>);
    line = line.replace(<span class="hljs-regexp">/\r/g</span>, <span class="hljs-string">'\\r'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54"></a>
</div>
<p>Escape double-quotes</p>
<ul>
<li>this will be the delimiter during execution</li>
</ul>

        </td>
        <td class="code highlight">
          <pre class="javascript">    line = line.replace(<span class="hljs-regexp">/"/g</span>, <span class="hljs-string">'\\"'</span>);
    <span class="hljs-keyword">this</span>.source += <span class="hljs-string">'    ; __append("'</span> + line + <span class="hljs-string">'")'</span> + <span class="hljs-string">'\n'</span>;
  },

  <span class="hljs-attr">scanLine</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">line</span>) </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">this</span>.opts.delimiter;
    <span class="hljs-keyword">var</span> o = <span class="hljs-keyword">this</span>.opts.openDelimiter;
    <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.opts.closeDelimiter;
    <span class="hljs-keyword">var</span> newLineCount = <span class="hljs-number">0</span>;

    newLineCount = (line.split(<span class="hljs-string">'\n'</span>).length - <span class="hljs-number">1</span>);

    <span class="hljs-keyword">switch</span> (line) {
    <span class="hljs-keyword">case</span> o + d:
    <span class="hljs-keyword">case</span> o + d + <span class="hljs-string">'_'</span>:
      <span class="hljs-keyword">this</span>.mode = Template.modes.EVAL;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> o + d + <span class="hljs-string">'='</span>:
      <span class="hljs-keyword">this</span>.mode = Template.modes.ESCAPED;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> o + d + <span class="hljs-string">'-'</span>:
      <span class="hljs-keyword">this</span>.mode = Template.modes.RAW;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> o + d + <span class="hljs-string">'#'</span>:
      <span class="hljs-keyword">this</span>.mode = Template.modes.COMMENT;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> o + d + d:
      <span class="hljs-keyword">this</span>.mode = Template.modes.LITERAL;
      <span class="hljs-keyword">this</span>.source += <span class="hljs-string">'    ; __append("'</span> + line.replace(o + d + d, o + d) + <span class="hljs-string">'")'</span> + <span class="hljs-string">'\n'</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> d + d + c:
      <span class="hljs-keyword">this</span>.mode = Template.modes.LITERAL;
      <span class="hljs-keyword">this</span>.source += <span class="hljs-string">'    ; __append("'</span> + line.replace(d + d + c, d + c) + <span class="hljs-string">'")'</span> + <span class="hljs-string">'\n'</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> d + c:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'-'</span> + d + c:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'_'</span> + d + c:
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.mode == Template.modes.LITERAL) {
        <span class="hljs-keyword">this</span>._addOutput(line);
      }

      <span class="hljs-keyword">this</span>.mode = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">this</span>.truncate = line.indexOf(<span class="hljs-string">'-'</span>) === <span class="hljs-number">0</span> || line.indexOf(<span class="hljs-string">'_'</span>) === <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55"></a>
</div>
<p>In script mode, depends on type of tag</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.mode) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56"></a>
</div>
<p>If '//' is found without a line break, add a line break.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.mode) {
        <span class="hljs-keyword">case</span> Template.modes.EVAL:
        <span class="hljs-keyword">case</span> Template.modes.ESCAPED:
        <span class="hljs-keyword">case</span> Template.modes.RAW:
          <span class="hljs-keyword">if</span> (line.lastIndexOf(<span class="hljs-string">'//'</span>) &gt; line.lastIndexOf(<span class="hljs-string">'\n'</span>)) {
            line += <span class="hljs-string">'\n'</span>;
          }
        }
        <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.mode) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57"></a>
</div>
<p>Just executing code</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">case</span> Template.modes.EVAL:
          <span class="hljs-keyword">this</span>.source += <span class="hljs-string">'    ; '</span> + line + <span class="hljs-string">'\n'</span>;
          <span class="hljs-keyword">break</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58"></a>
</div>
<p>Exec, esc, and output</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">case</span> Template.modes.ESCAPED:
          <span class="hljs-keyword">this</span>.source += <span class="hljs-string">'    ; __append(escapeFn('</span> + stripSemi(line) + <span class="hljs-string">'))'</span> + <span class="hljs-string">'\n'</span>;
          <span class="hljs-keyword">break</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59"></a>
</div>
<p>Exec and output</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">case</span> Template.modes.RAW:
          <span class="hljs-keyword">this</span>.source += <span class="hljs-string">'    ; __append('</span> + stripSemi(line) + <span class="hljs-string">')'</span> + <span class="hljs-string">'\n'</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> Template.modes.COMMENT:
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60"></a>
</div>
<p>Do nothing</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          <span class="hljs-keyword">break</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61"></a>
</div>
<p>Literal &lt;%% mode, append as raw output</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">case</span> Template.modes.LITERAL:
          <span class="hljs-keyword">this</span>._addOutput(line);
          <span class="hljs-keyword">break</span>;
        }
      }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62"></a>
</div>
<p>In string mode, just add the output</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>._addOutput(line);
      }
    }

    <span class="hljs-keyword">if</span> (self.opts.compileDebug &amp;&amp; newLineCount) {
      <span class="hljs-keyword">this</span>.currentLine += newLineCount;
      <span class="hljs-keyword">this</span>.source += <span class="hljs-string">'    ; __line = '</span> + <span class="hljs-keyword">this</span>.currentLine + <span class="hljs-string">'\n'</span>;
    }
  }
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63"></a>
</div>
<div class="dox">
<div class="summary">
<p>Escape characters reserved in XML.</p>
</div>
<div class="body">
<p>This is simply an export of {@link module:utils.escapeXML}.</p>
<p>If <code>markup</code> is <code>undefined</code> or <code>null</code>, the empty string is returned.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">markup</span>
<span class="dox_type">String</span>
<span>Input string
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">String</span>
<span>Escaped string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.escapeXML = utils.escapeXML;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64"></a>
</div>
<div class="dox">
<div class="summary">
<p>Express.js support.</p>
</div>
<div class="body">
<p>This is an alias for {@link module:ejs.renderFile}, in order to support
Express.js out-of-the-box.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.__express = exports.renderFile;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65"></a>
</div>
<p>Add require support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-comment">/* istanbul ignore else */</span>
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.extensions) {
  <span class="hljs-built_in">require</span>.extensions[<span class="hljs-string">'.ejs'</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">module, flnm</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Deprecated: this API will go away in EJS v2.8'</span>);
    <span class="hljs-keyword">var</span> filename = flnm || <span class="hljs-comment">/* istanbul ignore next */</span> <span class="hljs-built_in">module</span>.filename;
    <span class="hljs-keyword">var</span> options = {
      <span class="hljs-attr">filename</span>: filename,
      <span class="hljs-attr">client</span>: <span class="hljs-literal">true</span>
    };
    <span class="hljs-keyword">var</span> template = fileLoader(filename).toString();
    <span class="hljs-keyword">var</span> fn = exports.compile(template, options);
    <span class="hljs-built_in">module</span>._compile(<span class="hljs-string">'module.exports = '</span> + fn.toString() + <span class="hljs-string">';'</span>, filename);
  };
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66"></a>
</div>
<div class="dox">
<div class="summary">
<p>Version of EJS.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Type</div>
<div class="dox_tag_detail">
<span class="dox_type">String</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.VERSION = _VERSION_STRING;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67"></a>
</div>
<div class="dox">
<div class="summary">
<p>Name for detection of EJS.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Type</div>
<div class="dox_tag_detail">
<span class="dox_type">String</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.name = _NAME;

<span class="hljs-comment">/* istanbul ignore if */</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> != <span class="hljs-string">'undefined'</span>) {
  <span class="hljs-built_in">window</span>.ejs = exports;
}

},{<span class="hljs-string">"../package.json"</span>:<span class="hljs-number">6</span>,<span class="hljs-string">"./utils"</span>:<span class="hljs-number">2</span>,<span class="hljs-string">"fs"</span>:<span class="hljs-number">3</span>,<span class="hljs-string">"path"</span>:<span class="hljs-number">4</span>}],<span class="hljs-number">2</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">require,module,exports</span>)</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68"></a>
</div>
<div class="dox">
<div class="summary">
<p>EJS Embedded JavaScript templates
Copyright 2112 Matthew Eernisse (mde@fleegix.org)</p>
</div>
<div class="body">
<p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<pre><code>    http://www.apache.org/licenses/LICENSE-2.0
</code></pre>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69"></a>
</div>
<div class="dox">
<div class="summary">
<p>Private utility functions</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">
'use strict'</span>;

<span class="hljs-keyword">var</span> regExpChars = <span class="hljs-regexp">/[|\\{}()[\]^$+*?.]/g</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70"></a>
</div>
<div class="dox">
<div class="summary">
<p>Escape characters reserved in regular expressions.</p>
</div>
<div class="body">
<p>If <code>string</code> is <code>undefined</code> or <code>null</code>, the empty string is returned.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span class="dox_type">String</span>
<span>Input string
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">String</span>
<span>Escaped string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.escapeRegExpChars = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">string</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71"></a>
</div>
<p>istanbul ignore if</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!string) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>(string).replace(regExpChars, <span class="hljs-string">'\\$&amp;'</span>);
};

<span class="hljs-keyword">var</span> _ENCODE_HTML_RULES = {
  <span class="hljs-string">'&amp;'</span>: <span class="hljs-string">'&amp;amp;'</span>,
  <span class="hljs-string">'&lt;'</span>: <span class="hljs-string">'&amp;lt;'</span>,
  <span class="hljs-string">'&gt;'</span>: <span class="hljs-string">'&amp;gt;'</span>,
  <span class="hljs-string">'"'</span>: <span class="hljs-string">'&amp;#34;'</span>,
  <span class="hljs-string">"'"</span>: <span class="hljs-string">'&amp;#39;'</span>
};
<span class="hljs-keyword">var</span> _MATCH_HTML = <span class="hljs-regexp">/[&amp;&lt;&gt;'"]/g</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encode_char</span>(<span class="hljs-params">c</span>) </span>{
  <span class="hljs-keyword">return</span> _ENCODE_HTML_RULES[c] || c;
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-72" id="section-72"></a>
</div>
<div class="dox">
<div class="summary">
<p>Stringified version of constants used by {@link module:utils.escapeXML}.</p>
</div>
<div class="body">
<p>It is used in the process of generating {@link ClientFunction}s.</p>
</div>
<div class="details">
<div class="dox_tag_title">Type</div>
<div class="dox_tag_detail">
<span class="dox_type">String</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> escapeFuncStr =
  <span class="hljs-string">'var _ENCODE_HTML_RULES = {\n'</span>
+ <span class="hljs-string">'      "&amp;": "&amp;amp;"\n'</span>
+ <span class="hljs-string">'    , "&lt;": "&amp;lt;"\n'</span>
+ <span class="hljs-string">'    , "&gt;": "&amp;gt;"\n'</span>
+ <span class="hljs-string">'    , \'"\': "&amp;#34;"\n'</span>
+ <span class="hljs-string">'    , "\'": "&amp;#39;"\n'</span>
+ <span class="hljs-string">'    }\n'</span>
+ <span class="hljs-string">'  , _MATCH_HTML = /[&amp;&lt;&gt;\'"]/g;\n'</span>
+ <span class="hljs-string">'function encode_char(c) {\n'</span>
+ <span class="hljs-string">'  return _ENCODE_HTML_RULES[c] || c;\n'</span>
+ <span class="hljs-string">'};\n'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73"></a>
</div>
<div class="dox">
<div class="summary">
<p>Escape characters reserved in XML.</p>
</div>
<div class="body">
<p>If <code>markup</code> is <code>undefined</code> or <code>null</code>, the empty string is returned.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">markup</span>
<span class="dox_type">String</span>
<span>Input string
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">String</span>
<span>Escaped string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.escapeXML = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">markup</span>) </span>{
  <span class="hljs-keyword">return</span> markup == <span class="hljs-literal">undefined</span>
    ? <span class="hljs-string">''</span>
    : <span class="hljs-built_in">String</span>(markup)
      .replace(_MATCH_HTML, encode_char);
};
exports.escapeXML.toString = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Function</span>.prototype.toString.call(<span class="hljs-keyword">this</span>) + <span class="hljs-string">';\n'</span> + escapeFuncStr;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74"></a>
</div>
<div class="dox">
<div class="summary">
<p>Naive copy of properties from one object to another.
Does not recurse into non-scalar properties
Does not check to see if the property has a value before copying</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">to</span>
<span class="dox_type">Object</span>
<span>Destination object
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">from</span>
<span class="dox_type">Object</span>
<span>Source object
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
<span>Destination object
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.shallowCopy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">to, from</span>) </span>{
  <span class="hljs-keyword">from</span> = <span class="hljs-keyword">from</span> || {};
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p <span class="hljs-keyword">in</span> <span class="hljs-keyword">from</span>) {
    to[p] = <span class="hljs-keyword">from</span>[p];
  }
  <span class="hljs-keyword">return</span> to;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75"></a>
</div>
<div class="dox">
<div class="summary">
<p>Naive copy of a list of key names, from one object to another.
Only copies property if it is actually defined
Does not recurse into non-scalar properties</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">to</span>
<span class="dox_type">Object</span>
<span>Destination object
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">from</span>
<span class="dox_type">Object</span>
<span>Source object
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">list</span>
<span class="dox_type">Array</span>
<span>List of properties to copy
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
<span>Destination object
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.shallowCopyFromList = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">to, from, list</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list.length; i++) {
    <span class="hljs-keyword">var</span> p = list[i];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">from</span>[p] != <span class="hljs-string">'undefined'</span>) {
      to[p] = <span class="hljs-keyword">from</span>[p];
    }
  }
  <span class="hljs-keyword">return</span> to;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76"></a>
</div>
<div class="dox">
<div class="summary">
<p>Simple in-process cache implementation. Does not implement limits of any
sort.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.cache = {
  <span class="hljs-attr">_data</span>: {},
  <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key, val</span>) </span>{
    <span class="hljs-keyword">this</span>._data[key] = val;
  },
  <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._data[key];
  },
  <span class="hljs-attr">remove</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._data[key];
  },
  <span class="hljs-attr">reset</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._data = {};
  }
};

},{}],<span class="hljs-number">3</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">require,module,exports</span>)</span>{

},{}],<span class="hljs-number">4</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">require,module,exports</span>)</span>{
(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">process</span>)</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77"></a>
</div>
<p>.dirname, .basename, and .extname methods are extracted from Node.js v8.11.1,
backported and transplited with Babel, with backwards-compat fixes</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78"></a>
</div>
<p>Copyright Joyent, Inc. and other Node contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&quot;Software&quot;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to permit
persons to whom the Software is furnished to do so, subject to the
following conditions:</p>
<p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
USE OR OTHER DEALINGS IN THE SOFTWARE.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79"></a>
</div>
<p>resolves . and .. elements in a path array with directory names there
must be no slashes, empty elements, or device names (c:) in the array
(so also no leading and trailing slashes - it does not distinguish
relative and absolute paths)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalizeArray</span>(<span class="hljs-params">parts, allowAboveRoot</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80"></a>
</div>
<p>if the path tries to go above the root, <code>up</code> ends up &gt; 0</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> up = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = parts.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
    <span class="hljs-keyword">var</span> last = parts[i];
    <span class="hljs-keyword">if</span> (last === <span class="hljs-string">'.'</span>) {
      parts.splice(i, <span class="hljs-number">1</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (last === <span class="hljs-string">'..'</span>) {
      parts.splice(i, <span class="hljs-number">1</span>);
      up++;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (up) {
      parts.splice(i, <span class="hljs-number">1</span>);
      up--;
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81"></a>
</div>
<p>if the path is allowed to go above the root, restore leading ..s</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (allowAboveRoot) {
    <span class="hljs-keyword">for</span> (; up--; up) {
      parts.unshift(<span class="hljs-string">'..'</span>);
    }
  }

  <span class="hljs-keyword">return</span> parts;
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82"></a>
</div>
<p>path.resolve([from ...], to)
posix version</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.resolve = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> resolvedPath = <span class="hljs-string">''</span>,
      resolvedAbsolute = <span class="hljs-literal">false</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-built_in">arguments</span>.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">-1</span> &amp;&amp; !resolvedAbsolute; i--) {
    <span class="hljs-keyword">var</span> path = (i &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-built_in">arguments</span>[i] : process.cwd();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83"></a>
</div>
<p>Skip empty and invalid entries</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> path !== <span class="hljs-string">'string'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'Arguments to path.resolve must be strings'</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!path) {
      <span class="hljs-keyword">continue</span>;
    }

    resolvedPath = path + <span class="hljs-string">'/'</span> + resolvedPath;
    resolvedAbsolute = path.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">'/'</span>;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84"></a>
</div>
<p>At this point the path should be resolved to a full absolute path, but
handle relative paths to be safe (might happen when process.cwd() fails)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85"></a>
</div>
<p>Normalize the path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  resolvedPath = normalizeArray(filter(resolvedPath.split(<span class="hljs-string">'/'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">p</span>) </span>{
    <span class="hljs-keyword">return</span> !!p;
  }), !resolvedAbsolute).join(<span class="hljs-string">'/'</span>);

  <span class="hljs-keyword">return</span> ((resolvedAbsolute ? <span class="hljs-string">'/'</span> : <span class="hljs-string">''</span>) + resolvedPath) || <span class="hljs-string">'.'</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86"></a>
</div>
<p>path.normalize(path)
posix version</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.normalize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">var</span> isAbsolute = exports.isAbsolute(path),
      trailingSlash = substr(path, <span class="hljs-number">-1</span>) === <span class="hljs-string">'/'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87"></a>
</div>
<p>Normalize the path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  path = normalizeArray(filter(path.split(<span class="hljs-string">'/'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">p</span>) </span>{
    <span class="hljs-keyword">return</span> !!p;
  }), !isAbsolute).join(<span class="hljs-string">'/'</span>);

  <span class="hljs-keyword">if</span> (!path &amp;&amp; !isAbsolute) {
    path = <span class="hljs-string">'.'</span>;
  }
  <span class="hljs-keyword">if</span> (path &amp;&amp; trailingSlash) {
    path += <span class="hljs-string">'/'</span>;
  }

  <span class="hljs-keyword">return</span> (isAbsolute ? <span class="hljs-string">'/'</span> : <span class="hljs-string">''</span>) + path;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88"></a>
</div>
<p>posix version</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.isAbsolute = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">return</span> path.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">'/'</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89"></a>
</div>
<p>posix version</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.join = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> paths = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>);
  <span class="hljs-keyword">return</span> exports.normalize(filter(paths, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">p, index</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> p !== <span class="hljs-string">'string'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'Arguments to path.join must be strings'</span>);
    }
    <span class="hljs-keyword">return</span> p;
  }).join(<span class="hljs-string">'/'</span>));
};


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-90" id="section-90"></a>
</div>
<p>path.relative(from, to)
posix version</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.relative = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">from, to</span>) </span>{
  <span class="hljs-keyword">from</span> = exports.resolve(<span class="hljs-keyword">from</span>).substr(<span class="hljs-number">1</span>);
  to = exports.resolve(to).substr(<span class="hljs-number">1</span>);

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trim</span>(<span class="hljs-params">arr</span>) </span>{
    <span class="hljs-keyword">var</span> start = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (; start &lt; arr.length; start++) {
      <span class="hljs-keyword">if</span> (arr[start] !== <span class="hljs-string">''</span>) <span class="hljs-keyword">break</span>;
    }

    <span class="hljs-keyword">var</span> end = arr.length - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (; end &gt;= <span class="hljs-number">0</span>; end--) {
      <span class="hljs-keyword">if</span> (arr[end] !== <span class="hljs-string">''</span>) <span class="hljs-keyword">break</span>;
    }

    <span class="hljs-keyword">if</span> (start &gt; end) <span class="hljs-keyword">return</span> [];
    <span class="hljs-keyword">return</span> arr.slice(start, end - start + <span class="hljs-number">1</span>);
  }

  <span class="hljs-keyword">var</span> fromParts = trim(<span class="hljs-keyword">from</span>.split(<span class="hljs-string">'/'</span>));
  <span class="hljs-keyword">var</span> toParts = trim(to.split(<span class="hljs-string">'/'</span>));

  <span class="hljs-keyword">var</span> length = <span class="hljs-built_in">Math</span>.min(fromParts.length, toParts.length);
  <span class="hljs-keyword">var</span> samePartsLength = length;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {
    <span class="hljs-keyword">if</span> (fromParts[i] !== toParts[i]) {
      samePartsLength = i;
      <span class="hljs-keyword">break</span>;
    }
  }

  <span class="hljs-keyword">var</span> outputParts = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = samePartsLength; i &lt; fromParts.length; i++) {
    outputParts.push(<span class="hljs-string">'..'</span>);
  }

  outputParts = outputParts.concat(toParts.slice(samePartsLength));

  <span class="hljs-keyword">return</span> outputParts.join(<span class="hljs-string">'/'</span>);
};

exports.sep = <span class="hljs-string">'/'</span>;
exports.delimiter = <span class="hljs-string">':'</span>;

exports.dirname = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> path !== <span class="hljs-string">'string'</span>) path = path + <span class="hljs-string">''</span>;
  <span class="hljs-keyword">if</span> (path.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'.'</span>;
  <span class="hljs-keyword">var</span> code = path.charCodeAt(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">var</span> hasRoot = code === <span class="hljs-number">47</span> <span class="hljs-comment">/*/*/</span>;
  <span class="hljs-keyword">var</span> end = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">var</span> matchedSlash = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = path.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">1</span>; --i) {
    code = path.charCodeAt(i);
    <span class="hljs-keyword">if</span> (code === <span class="hljs-number">47</span> <span class="hljs-comment">/*/*/</span>) {
        <span class="hljs-keyword">if</span> (!matchedSlash) {
          end = i;
          <span class="hljs-keyword">break</span>;
        }
      } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-91" id="section-91"></a>
</div>
<p>We saw the first non-path separator</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      matchedSlash = <span class="hljs-literal">false</span>;
    }
  }

  <span class="hljs-keyword">if</span> (end === <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span> hasRoot ? <span class="hljs-string">'/'</span> : <span class="hljs-string">'.'</span>;
  <span class="hljs-keyword">if</span> (hasRoot &amp;&amp; end === <span class="hljs-number">1</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-92" id="section-92"></a>
</div>
<p>return '//';
Backwards-compat fix:</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> <span class="hljs-string">'/'</span>;
  }
  <span class="hljs-keyword">return</span> path.slice(<span class="hljs-number">0</span>, end);
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">basename</span>(<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> path !== <span class="hljs-string">'string'</span>) path = path + <span class="hljs-string">''</span>;

  <span class="hljs-keyword">var</span> start = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> end = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">var</span> matchedSlash = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">var</span> i;

  <span class="hljs-keyword">for</span> (i = path.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; --i) {
    <span class="hljs-keyword">if</span> (path.charCodeAt(i) === <span class="hljs-number">47</span> <span class="hljs-comment">/*/*/</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-93" id="section-93"></a>
</div>
<p>If we reached a path separator that was not part of a set of path
separators at the end of the string, stop now</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (!matchedSlash) {
          start = i + <span class="hljs-number">1</span>;
          <span class="hljs-keyword">break</span>;
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (end === <span class="hljs-number">-1</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-94" id="section-94"></a>
</div>
<p>We saw the first non-path separator, mark this as the end of our
path component</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      matchedSlash = <span class="hljs-literal">false</span>;
      end = i + <span class="hljs-number">1</span>;
    }
  }

  <span class="hljs-keyword">if</span> (end === <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
  <span class="hljs-keyword">return</span> path.slice(start, end);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-95" id="section-95"></a>
</div>
<p>Uses a mixed approach for backwards-compatibility, as ext behavior changed
in new Node.js versions, so only basename() above is backported here</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.basename = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path, ext</span>) </span>{
  <span class="hljs-keyword">var</span> f = basename(path);
  <span class="hljs-keyword">if</span> (ext &amp;&amp; f.substr(<span class="hljs-number">-1</span> * ext.length) === ext) {
    f = f.substr(<span class="hljs-number">0</span>, f.length - ext.length);
  }
  <span class="hljs-keyword">return</span> f;
};

exports.extname = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> path !== <span class="hljs-string">'string'</span>) path = path + <span class="hljs-string">''</span>;
  <span class="hljs-keyword">var</span> startDot = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">var</span> startPart = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> end = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">var</span> matchedSlash = <span class="hljs-literal">true</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-96" id="section-96"></a>
</div>
<p>Track the state of characters (if any) we see before our first dot and
after any path separator we find</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> preDotState = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = path.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; --i) {
    <span class="hljs-keyword">var</span> code = path.charCodeAt(i);
    <span class="hljs-keyword">if</span> (code === <span class="hljs-number">47</span> <span class="hljs-comment">/*/*/</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-97" id="section-97"></a>
</div>
<p>If we reached a path separator that was not part of a set of path
separators at the end of the string, stop now</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (!matchedSlash) {
          startPart = i + <span class="hljs-number">1</span>;
          <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-keyword">continue</span>;
      }
    <span class="hljs-keyword">if</span> (end === <span class="hljs-number">-1</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-98" id="section-98"></a>
</div>
<p>We saw the first non-path separator, mark this as the end of our
extension</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      matchedSlash = <span class="hljs-literal">false</span>;
      end = i + <span class="hljs-number">1</span>;
    }
    <span class="hljs-keyword">if</span> (code === <span class="hljs-number">46</span> <span class="hljs-comment">/*.*/</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-99" id="section-99"></a>
</div>
<p>If this is our first dot, mark it as the start of our extension</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (startDot === <span class="hljs-number">-1</span>)
          startDot = i;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (preDotState !== <span class="hljs-number">1</span>)
          preDotState = <span class="hljs-number">1</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (startDot !== <span class="hljs-number">-1</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-100" id="section-100"></a>
</div>
<p>We saw a non-dot and non-path separator before our dot, so we should
have a good chance at having a non-empty extension</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      preDotState = <span class="hljs-number">-1</span>;
    }
  }

  <span class="hljs-keyword">if</span> (startDot === <span class="hljs-number">-1</span> || end === <span class="hljs-number">-1</span> ||
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-101" id="section-101"></a>
</div>
<p>We saw a non-dot character immediately before the dot</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      preDotState === <span class="hljs-number">0</span> ||
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-102" id="section-102"></a>
</div>
<p>The (right-most) trimmed path component is exactly '..'</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      preDotState === <span class="hljs-number">1</span> &amp;&amp; startDot === end - <span class="hljs-number">1</span> &amp;&amp; startDot === startPart + <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
  }
  <span class="hljs-keyword">return</span> path.slice(startDot, end);
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span> (<span class="hljs-params">xs, f</span>) </span>{
    <span class="hljs-keyword">if</span> (xs.filter) <span class="hljs-keyword">return</span> xs.filter(f);
    <span class="hljs-keyword">var</span> res = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; xs.length; i++) {
        <span class="hljs-keyword">if</span> (f(xs[i], i, xs)) res.push(xs[i]);
    }
    <span class="hljs-keyword">return</span> res;
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-103" id="section-103"></a>
</div>
<p>String.prototype.substr - negative index don't work in IE8</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> substr = <span class="hljs-string">'ab'</span>.substr(<span class="hljs-number">-1</span>) === <span class="hljs-string">'b'</span>
    ? <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str, start, len</span>) </span>{ <span class="hljs-keyword">return</span> str.substr(start, len) }
    : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str, start, len</span>) </span>{
        <span class="hljs-keyword">if</span> (start &lt; <span class="hljs-number">0</span>) start = str.length + start;
        <span class="hljs-keyword">return</span> str.substr(start, len);
    }
;

}).call(<span class="hljs-keyword">this</span>,<span class="hljs-built_in">require</span>(<span class="hljs-string">'_process'</span>))
},{<span class="hljs-string">"_process"</span>:<span class="hljs-number">5</span>}],<span class="hljs-number">5</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">require,module,exports</span>)</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-104" id="section-104"></a>
</div>
<p>shim for using process in browser</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> process = <span class="hljs-built_in">module</span>.exports = {};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-105" id="section-105"></a>
</div>
<p>cached from whatever global is present so that test runners that stub it
don't break things.  But we need to wrap it in a try catch in case it is
wrapped in strict mode code which doesn't define any globals.  It's inside a
function because try/catches deoptimize in certain engines.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> cachedSetTimeout;
<span class="hljs-keyword">var</span> cachedClearTimeout;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">defaultSetTimout</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'setTimeout has not been defined'</span>);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">defaultClearTimeout</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'clearTimeout has not been defined'</span>);
}
(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> setTimeout === <span class="hljs-string">'function'</span>) {
            cachedSetTimeout = setTimeout;
        } <span class="hljs-keyword">else</span> {
            cachedSetTimeout = defaultSetTimout;
        }
    } <span class="hljs-keyword">catch</span> (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> clearTimeout === <span class="hljs-string">'function'</span>) {
            cachedClearTimeout = clearTimeout;
        } <span class="hljs-keyword">else</span> {
            cachedClearTimeout = defaultClearTimeout;
        }
    } <span class="hljs-keyword">catch</span> (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runTimeout</span>(<span class="hljs-params">fun</span>) </span>{
    <span class="hljs-keyword">if</span> (cachedSetTimeout === setTimeout) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-106" id="section-106"></a>
</div>
<p>normal enviroments in sane situations</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> setTimeout(fun, <span class="hljs-number">0</span>);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-107" id="section-107"></a>
</div>
<p>if setTimeout wasn't available but was latter defined</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) &amp;&amp; setTimeout) {
        cachedSetTimeout = setTimeout;
        <span class="hljs-keyword">return</span> setTimeout(fun, <span class="hljs-number">0</span>);
    }
    <span class="hljs-keyword">try</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-108" id="section-108"></a>
</div>
<p>when when somebody has screwed with setTimeout but no I.E. maddness</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> cachedSetTimeout(fun, <span class="hljs-number">0</span>);
    } <span class="hljs-keyword">catch</span>(e){
        <span class="hljs-keyword">try</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-109" id="section-109"></a>
</div>
<p>When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">return</span> cachedSetTimeout.call(<span class="hljs-literal">null</span>, fun, <span class="hljs-number">0</span>);
        } <span class="hljs-keyword">catch</span>(e){
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-110" id="section-110"></a>
</div>
<p>same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">return</span> cachedSetTimeout.call(<span class="hljs-keyword">this</span>, fun, <span class="hljs-number">0</span>);
        }
    }


}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runClearTimeout</span>(<span class="hljs-params">marker</span>) </span>{
    <span class="hljs-keyword">if</span> (cachedClearTimeout === clearTimeout) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-111" id="section-111"></a>
</div>
<p>normal enviroments in sane situations</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> clearTimeout(marker);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-112" id="section-112"></a>
</div>
<p>if clearTimeout wasn't available but was latter defined</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) &amp;&amp; clearTimeout) {
        cachedClearTimeout = clearTimeout;
        <span class="hljs-keyword">return</span> clearTimeout(marker);
    }
    <span class="hljs-keyword">try</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-113" id="section-113"></a>
</div>
<p>when when somebody has screwed with setTimeout but no I.E. maddness</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> cachedClearTimeout(marker);
    } <span class="hljs-keyword">catch</span> (e){
        <span class="hljs-keyword">try</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-114" id="section-114"></a>
</div>
<p>When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">return</span> cachedClearTimeout.call(<span class="hljs-literal">null</span>, marker);
        } <span class="hljs-keyword">catch</span> (e){
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-115" id="section-115"></a>
</div>
<p>same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
Some versions of I.E. have different rules for clearTimeout vs setTimeout</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">return</span> cachedClearTimeout.call(<span class="hljs-keyword">this</span>, marker);
        }
    }



}
<span class="hljs-keyword">var</span> queue = [];
<span class="hljs-keyword">var</span> draining = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">var</span> currentQueue;
<span class="hljs-keyword">var</span> queueIndex = <span class="hljs-number">-1</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanUpNextTick</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (!draining || !currentQueue) {
        <span class="hljs-keyword">return</span>;
    }
    draining = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } <span class="hljs-keyword">else</span> {
        queueIndex = <span class="hljs-number">-1</span>;
    }
    <span class="hljs-keyword">if</span> (queue.length) {
        drainQueue();
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drainQueue</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (draining) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">var</span> timeout = runTimeout(cleanUpNextTick);
    draining = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">var</span> len = queue.length;
    <span class="hljs-keyword">while</span>(len) {
        currentQueue = queue;
        queue = [];
        <span class="hljs-keyword">while</span> (++queueIndex &lt; len) {
            <span class="hljs-keyword">if</span> (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = <span class="hljs-number">-1</span>;
        len = queue.length;
    }
    currentQueue = <span class="hljs-literal">null</span>;
    draining = <span class="hljs-literal">false</span>;
    runClearTimeout(timeout);
}

process.nextTick = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fun</span>) </span>{
    <span class="hljs-keyword">var</span> args = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-built_in">arguments</span>.length - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-built_in">arguments</span>.length; i++) {
            args[i - <span class="hljs-number">1</span>] = <span class="hljs-built_in">arguments</span>[i];
        }
    }
    queue.push(<span class="hljs-keyword">new</span> Item(fun, args));
    <span class="hljs-keyword">if</span> (queue.length === <span class="hljs-number">1</span> &amp;&amp; !draining) {
        runTimeout(drainQueue);
    }
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-116" id="section-116"></a>
</div>
<p>v8 likes predictible objects</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Item</span>(<span class="hljs-params">fun, array</span>) </span>{
    <span class="hljs-keyword">this</span>.fun = fun;
    <span class="hljs-keyword">this</span>.array = array;
}
Item.prototype.run = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.fun.apply(<span class="hljs-literal">null</span>, <span class="hljs-keyword">this</span>.array);
};
process.title = <span class="hljs-string">'browser'</span>;
process.browser = <span class="hljs-literal">true</span>;
process.env = {};
process.argv = [];
process.version = <span class="hljs-string">''</span>; <span class="hljs-comment">// empty string to avoid regexp issues</span>
process.versions = {};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">noop</span>(<span class="hljs-params"></span>) </span>{}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{ <span class="hljs-keyword">return</span> [] }

process.binding = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'process.binding is not supported'</span>);
};

process.cwd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">'/'</span> };
process.chdir = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dir</span>) </span>{
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'process.chdir is not supported'</span>);
};
process.umask = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; };

},{}],<span class="hljs-number">6</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">require,module,exports</span>)</span>{
<span class="hljs-built_in">module</span>.exports={
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"ejs"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Embedded JavaScript templates"</span>,
  <span class="hljs-string">"keywords"</span>: [
    <span class="hljs-string">"template"</span>,
    <span class="hljs-string">"engine"</span>,
    <span class="hljs-string">"ejs"</span>
  ],
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"2.7.4"</span>,
  <span class="hljs-string">"author"</span>: <span class="hljs-string">"Matthew Eernisse &lt;mde@fleegix.org&gt; (http://fleegix.org)"</span>,
  <span class="hljs-string">"license"</span>: <span class="hljs-string">"Apache-2.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"./lib/ejs.js"</span>,
  <span class="hljs-string">"repository"</span>: {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"git"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"git://github.com/mde/ejs.git"</span>
  },
  <span class="hljs-string">"bugs"</span>: <span class="hljs-string">"https://github.com/mde/ejs/issues"</span>,
  <span class="hljs-string">"homepage"</span>: <span class="hljs-string">"https://github.com/mde/ejs"</span>,
  <span class="hljs-string">"dependencies"</span>: {},
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"browserify"</span>: <span class="hljs-string">"^13.1.1"</span>,
    <span class="hljs-string">"eslint"</span>: <span class="hljs-string">"^4.14.0"</span>,
    <span class="hljs-string">"git-directory-deploy"</span>: <span class="hljs-string">"^1.5.1"</span>,
    <span class="hljs-string">"jake"</span>: <span class="hljs-string">"^10.3.1"</span>,
    <span class="hljs-string">"jsdoc"</span>: <span class="hljs-string">"^3.4.0"</span>,
    <span class="hljs-string">"lru-cache"</span>: <span class="hljs-string">"^4.0.1"</span>,
    <span class="hljs-string">"mocha"</span>: <span class="hljs-string">"^5.0.5"</span>,
    <span class="hljs-string">"uglify-js"</span>: <span class="hljs-string">"^3.3.16"</span>
  },
  <span class="hljs-string">"engines"</span>: {
    <span class="hljs-string">"node"</span>: <span class="hljs-string">"&gt;=0.10.0"</span>
  },
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"mocha"</span>,
    <span class="hljs-string">"postinstall"</span>: <span class="hljs-string">"node ./postinstall.js"</span>
  }
}

},{}]},{},[<span class="hljs-number">1</span>])(<span class="hljs-number">1</span>)
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
