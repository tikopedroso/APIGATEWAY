<!DOCTYPE html>
<html>
<head>
  <title>source-map-resolve.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\source-map-resolve\\source-map-resolve.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>source-map-resolve.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>Note: source-map-resolve.js is generated from source-map-resolve-node.js and
source-map-resolve-template.js. Only edit the two latter files, <em>not</em>
source-map-resolve.js!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">void</span> (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">root, factory</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">"function"</span> &amp;&amp; define.amd) {
    define([<span class="hljs-string">"source-map-url"</span>, <span class="hljs-string">"resolve-url"</span>], factory)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports === <span class="hljs-string">"object"</span>) {
    <span class="hljs-keyword">var</span> sourceMappingURL = <span class="hljs-built_in">require</span>(<span class="hljs-string">"source-map-url"</span>)
    <span class="hljs-keyword">var</span> resolveUrl = <span class="hljs-built_in">require</span>(<span class="hljs-string">"resolve-url"</span>)
    <span class="hljs-built_in">module</span>.exports = factory(sourceMappingURL, resolveUrl)
  } <span class="hljs-keyword">else</span> {
    root.sourceMapResolve = factory(root.sourceMappingURL, root.resolveUrl)
  }
}(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sourceMappingURL, resolveUrl</span>) </span>{

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callbackAsync</span>(<span class="hljs-params">callback, error, result</span>) </span>{
    setImmediate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ callback(error, result) })
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseMapToJSON</span>(<span class="hljs-params">string, data</span>) </span>{
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.parse(string.replace(<span class="hljs-regexp">/^\)\]\}'/</span>, <span class="hljs-string">""</span>))
    } <span class="hljs-keyword">catch</span> (error) {
      error.sourceMapData = data
      <span class="hljs-keyword">throw</span> error
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readSync</span>(<span class="hljs-params">read, url, data</span>) </span>{
    <span class="hljs-keyword">var</span> readUrl = url
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>(read(readUrl))
    } <span class="hljs-keyword">catch</span> (error) {
      error.sourceMapData = data
      <span class="hljs-keyword">throw</span> error
    }
  }



  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveSourceMap</span>(<span class="hljs-params">code, codeUrl, read, callback</span>) </span>{
    <span class="hljs-keyword">var</span> mapData
    <span class="hljs-keyword">try</span> {
      mapData = resolveSourceMapHelper(code, codeUrl)
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">return</span> callbackAsync(callback, error)
    }
    <span class="hljs-keyword">if</span> (!mapData || mapData.map) {
      <span class="hljs-keyword">return</span> callbackAsync(callback, <span class="hljs-literal">null</span>, mapData)
    }
    <span class="hljs-keyword">var</span> readUrl = mapData.url
    read(readUrl, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error, result</span>) </span>{
      <span class="hljs-keyword">if</span> (error) {
        error.sourceMapData = mapData
        <span class="hljs-keyword">return</span> callback(error)
      }
      mapData.map = <span class="hljs-built_in">String</span>(result)
      <span class="hljs-keyword">try</span> {
        mapData.map = parseMapToJSON(mapData.map, mapData)
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-keyword">return</span> callback(error)
      }
      callback(<span class="hljs-literal">null</span>, mapData)
    })
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveSourceMapSync</span>(<span class="hljs-params">code, codeUrl, read</span>) </span>{
    <span class="hljs-keyword">var</span> mapData = resolveSourceMapHelper(code, codeUrl)
    <span class="hljs-keyword">if</span> (!mapData || mapData.map) {
      <span class="hljs-keyword">return</span> mapData
    }
    mapData.map = readSync(read, mapData.url, mapData)
    mapData.map = parseMapToJSON(mapData.map, mapData)
    <span class="hljs-keyword">return</span> mapData
  }

  <span class="hljs-keyword">var</span> dataUriRegex = <span class="hljs-regexp">/^data:([^,;]*)(;[^,;]*)*(?:,(.*))?$/</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>The media type for JSON text is application/json.</p>
</div>
<div class="body">
<p>{@link https://tools.ietf.org/html/rfc8259#section-11 | IANA Considerations }</p>
<p><code>text/json</code> is non-standard media type</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> jsonMimeTypeRegex = <span class="hljs-regexp">/^(?:application|text)\/json$/</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>JSON text exchanged between systems that are not part of a closed ecosystem
MUST be encoded using UTF-8.</p>
</div>
<div class="body">
<p>{@link https://tools.ietf.org/html/rfc8259#section-8.1 | Character Encoding}</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> jsonCharacterEncoding = <span class="hljs-string">"utf-8"</span>

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">base64ToBuf</span>(<span class="hljs-params">b64</span>) </span>{
    <span class="hljs-keyword">var</span> binStr = atob(b64)
    <span class="hljs-keyword">var</span> len = binStr.length
    <span class="hljs-keyword">var</span> arr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(len)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) {
      arr[i] = binStr.charCodeAt(i)
    }
    <span class="hljs-keyword">return</span> arr
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decodeBase64String</span>(<span class="hljs-params">b64</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> TextDecoder === <span class="hljs-string">"undefined"</span> || <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Uint8Array</span> === <span class="hljs-string">"undefined"</span>) {
      <span class="hljs-keyword">return</span> atob(b64)
    }
    <span class="hljs-keyword">var</span> buf = base64ToBuf(b64);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Note: <code>decoder.decode</code> method will throw a <code>DOMException</code> with the
<code>&quot;EncodingError&quot;</code> value when an coding error is found.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> decoder = <span class="hljs-keyword">new</span> TextDecoder(jsonCharacterEncoding, {<span class="hljs-attr">fatal</span>: <span class="hljs-literal">true</span>})
    <span class="hljs-keyword">return</span> decoder.decode(buf);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveSourceMapHelper</span>(<span class="hljs-params">code, codeUrl</span>) </span>{
    <span class="hljs-keyword">var</span> url = sourceMappingURL.getFrom(code)
    <span class="hljs-keyword">if</span> (!url) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    }

    <span class="hljs-keyword">var</span> dataUri = url.match(dataUriRegex)
    <span class="hljs-keyword">if</span> (dataUri) {
      <span class="hljs-keyword">var</span> mimeType = dataUri[<span class="hljs-number">1</span>] || <span class="hljs-string">"text/plain"</span>
      <span class="hljs-keyword">var</span> lastParameter = dataUri[<span class="hljs-number">2</span>] || <span class="hljs-string">""</span>
      <span class="hljs-keyword">var</span> encoded = dataUri[<span class="hljs-number">3</span>] || <span class="hljs-string">""</span>
      <span class="hljs-keyword">var</span> data = {
        <span class="hljs-attr">sourceMappingURL</span>: url,
        <span class="hljs-attr">url</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">sourcesRelativeTo</span>: codeUrl,
        <span class="hljs-attr">map</span>: encoded
      }
      <span class="hljs-keyword">if</span> (!jsonMimeTypeRegex.test(mimeType)) {
        <span class="hljs-keyword">var</span> error = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Unuseful data uri mime type: "</span> + mimeType)
        error.sourceMapData = data
        <span class="hljs-keyword">throw</span> error
      }
      <span class="hljs-keyword">try</span> {
        data.map = parseMapToJSON(
          lastParameter === <span class="hljs-string">";base64"</span> ? decodeBase64String(encoded) : <span class="hljs-built_in">decodeURIComponent</span>(encoded),
          data
        )
      } <span class="hljs-keyword">catch</span> (error) {
        error.sourceMapData = data
        <span class="hljs-keyword">throw</span> error
      }
      <span class="hljs-keyword">return</span> data
    }

    <span class="hljs-keyword">var</span> mapUrl = resolveUrl(codeUrl, url)
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">sourceMappingURL</span>: url,
      <span class="hljs-attr">url</span>: mapUrl,
      <span class="hljs-attr">sourcesRelativeTo</span>: mapUrl,
      <span class="hljs-attr">map</span>: <span class="hljs-literal">null</span>
    }
  }



  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveSources</span>(<span class="hljs-params">map, mapUrl, read, options, callback</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options === <span class="hljs-string">"function"</span>) {
      callback = options
      options = {}
    }
    <span class="hljs-keyword">var</span> pending = map.sources ? map.sources.length : <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> result = {
      <span class="hljs-attr">sourcesResolved</span>: [],
      <span class="hljs-attr">sourcesContent</span>:  []
    }

    <span class="hljs-keyword">if</span> (pending === <span class="hljs-number">0</span>) {
      callbackAsync(callback, <span class="hljs-literal">null</span>, result)
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">var</span> done = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      pending--
      <span class="hljs-keyword">if</span> (pending === <span class="hljs-number">0</span>) {
        callback(<span class="hljs-literal">null</span>, result)
      }
    }

    resolveSourcesHelper(map, mapUrl, options, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fullUrl, sourceContent, index</span>) </span>{
      result.sourcesResolved[index] = fullUrl
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> sourceContent === <span class="hljs-string">"string"</span>) {
        result.sourcesContent[index] = sourceContent
        callbackAsync(done, <span class="hljs-literal">null</span>)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> readUrl = fullUrl
        read(readUrl, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error, source</span>) </span>{
          result.sourcesContent[index] = error ? error : <span class="hljs-built_in">String</span>(source)
          done()
        })
      }
    })
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveSourcesSync</span>(<span class="hljs-params">map, mapUrl, read, options</span>) </span>{
    <span class="hljs-keyword">var</span> result = {
      <span class="hljs-attr">sourcesResolved</span>: [],
      <span class="hljs-attr">sourcesContent</span>:  []
    }

    <span class="hljs-keyword">if</span> (!map.sources || map.sources.length === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> result
    }

    resolveSourcesHelper(map, mapUrl, options, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fullUrl, sourceContent, index</span>) </span>{
      result.sourcesResolved[index] = fullUrl
      <span class="hljs-keyword">if</span> (read !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> sourceContent === <span class="hljs-string">"string"</span>) {
          result.sourcesContent[index] = sourceContent
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">var</span> readUrl = fullUrl
          <span class="hljs-keyword">try</span> {
            result.sourcesContent[index] = <span class="hljs-built_in">String</span>(read(readUrl))
          } <span class="hljs-keyword">catch</span> (error) {
            result.sourcesContent[index] = error
          }
        }
      }
    })

    <span class="hljs-keyword">return</span> result
  }

  <span class="hljs-keyword">var</span> endingSlash = <span class="hljs-regexp">/\/?$/</span>

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveSourcesHelper</span>(<span class="hljs-params">map, mapUrl, options, fn</span>) </span>{
    options = options || {}
    <span class="hljs-keyword">var</span> fullUrl
    <span class="hljs-keyword">var</span> sourceContent
    <span class="hljs-keyword">var</span> sourceRoot
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>, len = map.sources.length; index &lt; len; index++) {
      sourceRoot = <span class="hljs-literal">null</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.sourceRoot === <span class="hljs-string">"string"</span>) {
        sourceRoot = options.sourceRoot
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> map.sourceRoot === <span class="hljs-string">"string"</span> &amp;&amp; options.sourceRoot !== <span class="hljs-literal">false</span>) {
        sourceRoot = map.sourceRoot
      }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>If the sourceRoot is the empty string, it is equivalent to not setting
the property at all.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (sourceRoot === <span class="hljs-literal">null</span> || sourceRoot === <span class="hljs-string">''</span>) {
        fullUrl = resolveUrl(mapUrl, map.sources[index])
      } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Make sure that the sourceRoot ends with a slash, so that <code>/scripts/subdir</code> becomes
<code>/scripts/subdir/&lt;source&gt;</code>, not <code>/scripts/&lt;source&gt;</code>. Pointing to a file as source root
does not make sense.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        fullUrl = resolveUrl(mapUrl, sourceRoot.replace(endingSlash, <span class="hljs-string">"/"</span>), map.sources[index])
      }
      sourceContent = (map.sourcesContent || [])[index]
      fn(fullUrl, sourceContent, index)
    }
  }



  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolve</span>(<span class="hljs-params">code, codeUrl, read, options, callback</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options === <span class="hljs-string">"function"</span>) {
      callback = options
      options = {}
    }
    <span class="hljs-keyword">if</span> (code === <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">var</span> mapUrl = codeUrl
      <span class="hljs-keyword">var</span> data = {
        <span class="hljs-attr">sourceMappingURL</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">url</span>: mapUrl,
        <span class="hljs-attr">sourcesRelativeTo</span>: mapUrl,
        <span class="hljs-attr">map</span>: <span class="hljs-literal">null</span>
      }
      <span class="hljs-keyword">var</span> readUrl = mapUrl
      read(readUrl, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error, result</span>) </span>{
        <span class="hljs-keyword">if</span> (error) {
          error.sourceMapData = data
          <span class="hljs-keyword">return</span> callback(error)
        }
        data.map = <span class="hljs-built_in">String</span>(result)
        <span class="hljs-keyword">try</span> {
          data.map = parseMapToJSON(data.map, data)
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-keyword">return</span> callback(error)
        }
        _resolveSources(data)
      })
    } <span class="hljs-keyword">else</span> {
      resolveSourceMap(code, codeUrl, read, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error, mapData</span>) </span>{
        <span class="hljs-keyword">if</span> (error) {
          <span class="hljs-keyword">return</span> callback(error)
        }
        <span class="hljs-keyword">if</span> (!mapData) {
          <span class="hljs-keyword">return</span> callback(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)
        }
        _resolveSources(mapData)
      })
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_resolveSources</span>(<span class="hljs-params">mapData</span>) </span>{
      resolveSources(mapData.map, mapData.sourcesRelativeTo, read, options, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error, result</span>) </span>{
        <span class="hljs-keyword">if</span> (error) {
          <span class="hljs-keyword">return</span> callback(error)
        }
        mapData.sourcesResolved = result.sourcesResolved
        mapData.sourcesContent  = result.sourcesContent
        callback(<span class="hljs-literal">null</span>, mapData)
      })
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveSync</span>(<span class="hljs-params">code, codeUrl, read, options</span>) </span>{
    <span class="hljs-keyword">var</span> mapData
    <span class="hljs-keyword">if</span> (code === <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">var</span> mapUrl = codeUrl
      mapData = {
        <span class="hljs-attr">sourceMappingURL</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">url</span>: mapUrl,
        <span class="hljs-attr">sourcesRelativeTo</span>: mapUrl,
        <span class="hljs-attr">map</span>: <span class="hljs-literal">null</span>
      }
      mapData.map = readSync(read, mapUrl, mapData)
      mapData.map = parseMapToJSON(mapData.map, mapData)
    } <span class="hljs-keyword">else</span> {
      mapData = resolveSourceMapSync(code, codeUrl, read)
      <span class="hljs-keyword">if</span> (!mapData) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
      }
    }
    <span class="hljs-keyword">var</span> result = resolveSourcesSync(mapData.map, mapData.sourcesRelativeTo, read, options)
    mapData.sourcesResolved = result.sourcesResolved
    mapData.sourcesContent  = result.sourcesContent
    <span class="hljs-keyword">return</span> mapData
  }



  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">resolveSourceMap</span>:     resolveSourceMap,
    <span class="hljs-attr">resolveSourceMapSync</span>: resolveSourceMapSync,
    <span class="hljs-attr">resolveSources</span>:       resolveSources,
    <span class="hljs-attr">resolveSourcesSync</span>:   resolveSourcesSync,
    <span class="hljs-attr">resolve</span>:              resolve,
    <span class="hljs-attr">resolveSync</span>:          resolveSync,
    <span class="hljs-attr">parseMapToJSON</span>:       parseMapToJSON
  }

}));

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
