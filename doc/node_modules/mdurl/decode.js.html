<!DOCTYPE html>
<html>
<head>
  <title>decode.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\mdurl\\decode.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>decode.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">
'use strict'</span>;


<span class="hljs-comment">/* eslint-disable no-bitwise */</span>

<span class="hljs-keyword">var</span> decodeCache = {};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDecodeCache</span>(<span class="hljs-params">exclude</span>) </span>{
  <span class="hljs-keyword">var</span> i, ch, cache = decodeCache[exclude];
  <span class="hljs-keyword">if</span> (cache) { <span class="hljs-keyword">return</span> cache; }

  cache = decodeCache[exclude] = [];

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">128</span>; i++) {
    ch = <span class="hljs-built_in">String</span>.fromCharCode(i);
    cache.push(ch);
  }

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; exclude.length; i++) {
    ch = exclude.charCodeAt(i);
    cache[ch] = <span class="hljs-string">'%'</span> + (<span class="hljs-string">'0'</span> + ch.toString(<span class="hljs-number">16</span>).toUpperCase()).slice(<span class="hljs-number">-2</span>);
  }

  <span class="hljs-keyword">return</span> cache;
}


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Decode percent-encoded string.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span>(<span class="hljs-params">string, exclude</span>) </span>{
  <span class="hljs-keyword">var</span> cache;

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exclude !== <span class="hljs-string">'string'</span>) {
    exclude = decode.defaultChars;
  }

  cache = getDecodeCache(exclude);

  <span class="hljs-keyword">return</span> string.replace(<span class="hljs-regexp">/(%[a-f0-9]{2})+/gi</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">seq</span>) </span>{
    <span class="hljs-keyword">var</span> i, l, b1, b2, b3, b4, chr,
        result = <span class="hljs-string">''</span>;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, l = seq.length; i &lt; l; i += <span class="hljs-number">3</span>) {
      b1 = <span class="hljs-built_in">parseInt</span>(seq.slice(i + <span class="hljs-number">1</span>, i + <span class="hljs-number">3</span>), <span class="hljs-number">16</span>);

      <span class="hljs-keyword">if</span> (b1 &lt; <span class="hljs-number">0x80</span>) {
        result += cache[b1];
        <span class="hljs-keyword">continue</span>;
      }

      <span class="hljs-keyword">if</span> ((b1 &amp; <span class="hljs-number">0xE0</span>) === <span class="hljs-number">0xC0</span> &amp;&amp; (i + <span class="hljs-number">3</span> &lt; l)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>110xxxxx 10xxxxxx</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        b2 = <span class="hljs-built_in">parseInt</span>(seq.slice(i + <span class="hljs-number">4</span>, i + <span class="hljs-number">6</span>), <span class="hljs-number">16</span>);

        <span class="hljs-keyword">if</span> ((b2 &amp; <span class="hljs-number">0xC0</span>) === <span class="hljs-number">0x80</span>) {
          chr = ((b1 &lt;&lt; <span class="hljs-number">6</span>) &amp; <span class="hljs-number">0x7C0</span>) | (b2 &amp; <span class="hljs-number">0x3F</span>);

          <span class="hljs-keyword">if</span> (chr &lt; <span class="hljs-number">0x80</span>) {
            result += <span class="hljs-string">'\ufffd\ufffd'</span>;
          } <span class="hljs-keyword">else</span> {
            result += <span class="hljs-built_in">String</span>.fromCharCode(chr);
          }

          i += <span class="hljs-number">3</span>;
          <span class="hljs-keyword">continue</span>;
        }
      }

      <span class="hljs-keyword">if</span> ((b1 &amp; <span class="hljs-number">0xF0</span>) === <span class="hljs-number">0xE0</span> &amp;&amp; (i + <span class="hljs-number">6</span> &lt; l)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>1110xxxx 10xxxxxx 10xxxxxx</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        b2 = <span class="hljs-built_in">parseInt</span>(seq.slice(i + <span class="hljs-number">4</span>, i + <span class="hljs-number">6</span>), <span class="hljs-number">16</span>);
        b3 = <span class="hljs-built_in">parseInt</span>(seq.slice(i + <span class="hljs-number">7</span>, i + <span class="hljs-number">9</span>), <span class="hljs-number">16</span>);

        <span class="hljs-keyword">if</span> ((b2 &amp; <span class="hljs-number">0xC0</span>) === <span class="hljs-number">0x80</span> &amp;&amp; (b3 &amp; <span class="hljs-number">0xC0</span>) === <span class="hljs-number">0x80</span>) {
          chr = ((b1 &lt;&lt; <span class="hljs-number">12</span>) &amp; <span class="hljs-number">0xF000</span>) | ((b2 &lt;&lt; <span class="hljs-number">6</span>) &amp; <span class="hljs-number">0xFC0</span>) | (b3 &amp; <span class="hljs-number">0x3F</span>);

          <span class="hljs-keyword">if</span> (chr &lt; <span class="hljs-number">0x800</span> || (chr &gt;= <span class="hljs-number">0xD800</span> &amp;&amp; chr &lt;= <span class="hljs-number">0xDFFF</span>)) {
            result += <span class="hljs-string">'\ufffd\ufffd\ufffd'</span>;
          } <span class="hljs-keyword">else</span> {
            result += <span class="hljs-built_in">String</span>.fromCharCode(chr);
          }

          i += <span class="hljs-number">6</span>;
          <span class="hljs-keyword">continue</span>;
        }
      }

      <span class="hljs-keyword">if</span> ((b1 &amp; <span class="hljs-number">0xF8</span>) === <span class="hljs-number">0xF0</span> &amp;&amp; (i + <span class="hljs-number">9</span> &lt; l)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>111110xx 10xxxxxx 10xxxxxx 10xxxxxx</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        b2 = <span class="hljs-built_in">parseInt</span>(seq.slice(i + <span class="hljs-number">4</span>, i + <span class="hljs-number">6</span>), <span class="hljs-number">16</span>);
        b3 = <span class="hljs-built_in">parseInt</span>(seq.slice(i + <span class="hljs-number">7</span>, i + <span class="hljs-number">9</span>), <span class="hljs-number">16</span>);
        b4 = <span class="hljs-built_in">parseInt</span>(seq.slice(i + <span class="hljs-number">10</span>, i + <span class="hljs-number">12</span>), <span class="hljs-number">16</span>);

        <span class="hljs-keyword">if</span> ((b2 &amp; <span class="hljs-number">0xC0</span>) === <span class="hljs-number">0x80</span> &amp;&amp; (b3 &amp; <span class="hljs-number">0xC0</span>) === <span class="hljs-number">0x80</span> &amp;&amp; (b4 &amp; <span class="hljs-number">0xC0</span>) === <span class="hljs-number">0x80</span>) {
          chr = ((b1 &lt;&lt; <span class="hljs-number">18</span>) &amp; <span class="hljs-number">0x1C0000</span>) | ((b2 &lt;&lt; <span class="hljs-number">12</span>) &amp; <span class="hljs-number">0x3F000</span>) | ((b3 &lt;&lt; <span class="hljs-number">6</span>) &amp; <span class="hljs-number">0xFC0</span>) | (b4 &amp; <span class="hljs-number">0x3F</span>);

          <span class="hljs-keyword">if</span> (chr &lt; <span class="hljs-number">0x10000</span> || chr &gt; <span class="hljs-number">0x10FFFF</span>) {
            result += <span class="hljs-string">'\ufffd\ufffd\ufffd\ufffd'</span>;
          } <span class="hljs-keyword">else</span> {
            chr -= <span class="hljs-number">0x10000</span>;
            result += <span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-number">0xD800</span> + (chr &gt;&gt; <span class="hljs-number">10</span>), <span class="hljs-number">0xDC00</span> + (chr &amp; <span class="hljs-number">0x3FF</span>));
          }

          i += <span class="hljs-number">9</span>;
          <span class="hljs-keyword">continue</span>;
        }
      }

      result += <span class="hljs-string">'\ufffd'</span>;
    }

    <span class="hljs-keyword">return</span> result;
  });
}


decode.defaultChars   = <span class="hljs-string">';/?:@&amp;=+$,#'</span>;
decode.componentChars = <span class="hljs-string">''</span>;


<span class="hljs-built_in">module</span>.exports = decode;

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
