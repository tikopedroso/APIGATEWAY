<!DOCTYPE html>
<html>
<head>
  <title>parse.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\mdurl\\parse.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>parse.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>Copyright Joyent, Inc. and other Node contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&quot;Software&quot;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to permit
persons to whom the Software is furnished to do so, subject to the
following conditions:</p>
<p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
USE OR OTHER DEALINGS IN THE SOFTWARE.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">
'use strict'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Changes from joyent/node:</p>
<ol>
<li>
<p>No leading slash in paths,
e.g. in <code>url.parse('http://foo?bar')</code> pathname is ``, not <code>/</code></p>
</li>
<li>
<p>Backslashes are not replaced with slashes,
so <code>http:\\example.org\</code> is treated like a relative path</p>
</li>
<li>
<p>Trailing colon is treated like a part of the path,
i.e. in <code>http://example.org:foo</code> pathname is <code>:foo</code></p>
</li>
<li>
<p>Nothing is URL-encoded in the resulting object,
(in joyent/node some chars in auth and paths are encoded)</p>
</li>
<li>
<p><code>url.parse()</code> does not have <code>parseQueryString</code> argument</p>
</li>
<li>
<p>Removed extraneous result properties: <code>host</code>, <code>path</code>, <code>query</code>, etc.,
which can be constructed using other parts of the url.</p>
</li>
</ol>

        </td>
        <td class="code highlight">
          <pre class="javascript">

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Url</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.protocol = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.slashes = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.auth = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.port = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.hostname = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.hash = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.search = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.pathname = <span class="hljs-literal">null</span>;
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Reference: RFC 3986, RFC 1808, RFC 2396</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>define these here so at least they only have to be
compiled once on the first module load.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> protocolPattern = <span class="hljs-regexp">/^([a-z0-9.+-]+:)/i</span>,
    portPattern = <span class="hljs-regexp">/:[0-9]*$/</span>,

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Special case for a simple path URL</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    simplePathPattern = <span class="hljs-regexp">/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/</span>,

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>RFC 2396: characters reserved for delimiting URLs.
We actually just auto-escape these.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    delims = [ <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'"'</span>, <span class="hljs-string">'`'</span>, <span class="hljs-string">' '</span>, <span class="hljs-string">'\r'</span>, <span class="hljs-string">'\n'</span>, <span class="hljs-string">'\t'</span> ],

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>RFC 2396: characters not allowed for various reasons.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    unwise = [ <span class="hljs-string">'{'</span>, <span class="hljs-string">'}'</span>, <span class="hljs-string">'|'</span>, <span class="hljs-string">'\\'</span>, <span class="hljs-string">'^'</span>, <span class="hljs-string">'`'</span> ].concat(delims),

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Allowed by RFCs, but cause of XSS attacks.  Always escape these.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    autoEscape = [ <span class="hljs-string">'\''</span> ].concat(unwise),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Characters that are never ever allowed in a hostname.
Note that any invalid chars are also handled, but these
are the ones that are <em>expected</em> to be seen, so we fast-path
them.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    nonHostChars = [ <span class="hljs-string">'%'</span>, <span class="hljs-string">'/'</span>, <span class="hljs-string">'?'</span>, <span class="hljs-string">';'</span>, <span class="hljs-string">'#'</span> ].concat(autoEscape),
    hostEndingChars = [ <span class="hljs-string">'/'</span>, <span class="hljs-string">'?'</span>, <span class="hljs-string">'#'</span> ],
    hostnameMaxLen = <span class="hljs-number">255</span>,
    hostnamePartPattern = <span class="hljs-regexp">/^[+a-z0-9A-Z_-]{0,63}$/</span>,
    hostnamePartStart = <span class="hljs-regexp">/^([+a-z0-9A-Z_-]{0,63})(.*)$/</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>protocols that can allow &quot;unsafe&quot; and &quot;unwise&quot; chars.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-comment">/* eslint-disable no-script-url */</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>protocols that never have a hostname.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    hostlessProtocol = {
      <span class="hljs-string">'javascript'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'javascript:'</span>: <span class="hljs-literal">true</span>
    },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>protocols that always contain a // bit.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    slashedProtocol = {
      <span class="hljs-string">'http'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'https'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'ftp'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'gopher'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'file'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'http:'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'https:'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'ftp:'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'gopher:'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'file:'</span>: <span class="hljs-literal">true</span>
    };
    <span class="hljs-comment">/* eslint-enable no-script-url */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">urlParse</span>(<span class="hljs-params">url, slashesDenoteHost</span>) </span>{
  <span class="hljs-keyword">if</span> (url &amp;&amp; url <span class="hljs-keyword">instanceof</span> Url) { <span class="hljs-keyword">return</span> url; }

  <span class="hljs-keyword">var</span> u = <span class="hljs-keyword">new</span> Url();
  u.parse(url, slashesDenoteHost);
  <span class="hljs-keyword">return</span> u;
}

Url.prototype.parse = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">url, slashesDenoteHost</span>) </span>{
  <span class="hljs-keyword">var</span> i, l, lowerProto, hec, slashes,
      rest = url;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>trim before proceeding.
This is to support parse stuff like &quot;  http://foo.com  \n&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  rest = rest.trim();

  <span class="hljs-keyword">if</span> (!slashesDenoteHost &amp;&amp; url.split(<span class="hljs-string">'#'</span>).length === <span class="hljs-number">1</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Try fast path regexp</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> simplePath = simplePathPattern.exec(rest);
    <span class="hljs-keyword">if</span> (simplePath) {
      <span class="hljs-keyword">this</span>.pathname = simplePath[<span class="hljs-number">1</span>];
      <span class="hljs-keyword">if</span> (simplePath[<span class="hljs-number">2</span>]) {
        <span class="hljs-keyword">this</span>.search = simplePath[<span class="hljs-number">2</span>];
      }
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
  }

  <span class="hljs-keyword">var</span> proto = protocolPattern.exec(rest);
  <span class="hljs-keyword">if</span> (proto) {
    proto = proto[<span class="hljs-number">0</span>];
    lowerProto = proto.toLowerCase();
    <span class="hljs-keyword">this</span>.protocol = proto;
    rest = rest.substr(proto.length);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>figure out if it's got a host
user@server is <em>always</em> interpreted as a hostname, and url
resolution will treat //foo/bar as host=foo,path=bar because that's
how the browser resolves relative URLs.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (slashesDenoteHost || proto || rest.match(<span class="hljs-regexp">/^\/\/[^@\/]+@[^@\/]+/</span>)) {
    slashes = rest.substr(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>) === <span class="hljs-string">'//'</span>;
    <span class="hljs-keyword">if</span> (slashes &amp;&amp; !(proto &amp;&amp; hostlessProtocol[proto])) {
      rest = rest.substr(<span class="hljs-number">2</span>);
      <span class="hljs-keyword">this</span>.slashes = <span class="hljs-literal">true</span>;
    }
  }

  <span class="hljs-keyword">if</span> (!hostlessProtocol[proto] &amp;&amp;
      (slashes || (proto &amp;&amp; !slashedProtocol[proto]))) {

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>there's a hostname.
the first instance of /, ?, ;, or # ends the host.</p>
<p>If there is an @ in the hostname, then non-host chars <em>are</em> allowed
to the left of the last @ sign, unless some host-ending character
comes <em>before</em> the @-sign.
URLs are obnoxious.</p>
<p>ex:
http://a@b@c/ =&gt; user:a@b host:c
http://a@b?@c =&gt; user:a host:c path:/?@c</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>v0.12 TODO(isaacs): This is not quite how Chrome does things.
Review our test case against browsers more comprehensively.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>find the first instance of any hostEndingChars</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> hostEnd = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; hostEndingChars.length; i++) {
      hec = rest.indexOf(hostEndingChars[i]);
      <span class="hljs-keyword">if</span> (hec !== <span class="hljs-number">-1</span> &amp;&amp; (hostEnd === <span class="hljs-number">-1</span> || hec &lt; hostEnd)) {
        hostEnd = hec;
      }
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>at this point, either we have an explicit point where the
auth portion cannot go past, or the last @ char is the decider.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> auth, atSign;
    <span class="hljs-keyword">if</span> (hostEnd === <span class="hljs-number">-1</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>atSign can be anywhere.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      atSign = rest.lastIndexOf(<span class="hljs-string">'@'</span>);
    } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>atSign must be in auth portion.
http://a@b/c@d =&gt; host:b auth:a path:/c@d</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      atSign = rest.lastIndexOf(<span class="hljs-string">'@'</span>, hostEnd);
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Now we have a portion which is definitely the auth.
Pull that off.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (atSign !== <span class="hljs-number">-1</span>) {
      auth = rest.slice(<span class="hljs-number">0</span>, atSign);
      rest = rest.slice(atSign + <span class="hljs-number">1</span>);
      <span class="hljs-keyword">this</span>.auth = auth;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>the host is the remaining to the left of the first non-host char</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    hostEnd = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; nonHostChars.length; i++) {
      hec = rest.indexOf(nonHostChars[i]);
      <span class="hljs-keyword">if</span> (hec !== <span class="hljs-number">-1</span> &amp;&amp; (hostEnd === <span class="hljs-number">-1</span> || hec &lt; hostEnd)) {
        hostEnd = hec;
      }
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>if we still have not hit it, then the entire thing is a host.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (hostEnd === <span class="hljs-number">-1</span>) {
      hostEnd = rest.length;
    }

    <span class="hljs-keyword">if</span> (rest[hostEnd - <span class="hljs-number">1</span>] === <span class="hljs-string">':'</span>) { hostEnd--; }
    <span class="hljs-keyword">var</span> host = rest.slice(<span class="hljs-number">0</span>, hostEnd);
    rest = rest.slice(hostEnd);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>pull out port.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.parseHost(host);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>we've indicated that there is a hostname,
so even if it's empty, it has to be present.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.hostname = <span class="hljs-keyword">this</span>.hostname || <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>if hostname begins with [ and ends with ]
assume that it's an IPv6 address.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> ipv6Hostname = <span class="hljs-keyword">this</span>.hostname[<span class="hljs-number">0</span>] === <span class="hljs-string">'['</span> &amp;&amp;
        <span class="hljs-keyword">this</span>.hostname[<span class="hljs-keyword">this</span>.hostname.length - <span class="hljs-number">1</span>] === <span class="hljs-string">']'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>validate a little.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!ipv6Hostname) {
      <span class="hljs-keyword">var</span> hostparts = <span class="hljs-keyword">this</span>.hostname.split(<span class="hljs-regexp">/\./</span>);
      <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, l = hostparts.length; i &lt; l; i++) {
        <span class="hljs-keyword">var</span> part = hostparts[i];
        <span class="hljs-keyword">if</span> (!part) { <span class="hljs-keyword">continue</span>; }
        <span class="hljs-keyword">if</span> (!part.match(hostnamePartPattern)) {
          <span class="hljs-keyword">var</span> newpart = <span class="hljs-string">''</span>;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>, k = part.length; j &lt; k; j++) {
            <span class="hljs-keyword">if</span> (part.charCodeAt(j) &gt; <span class="hljs-number">127</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>we replace non-ASCII char with a temporary placeholder
we need this to make sure size of hostname is not
broken by replacing non-ASCII by nothing</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">              newpart += <span class="hljs-string">'x'</span>;
            } <span class="hljs-keyword">else</span> {
              newpart += part[j];
            }
          }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>we test again with ASCII char only</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          <span class="hljs-keyword">if</span> (!newpart.match(hostnamePartPattern)) {
            <span class="hljs-keyword">var</span> validParts = hostparts.slice(<span class="hljs-number">0</span>, i);
            <span class="hljs-keyword">var</span> notHost = hostparts.slice(i + <span class="hljs-number">1</span>);
            <span class="hljs-keyword">var</span> bit = part.match(hostnamePartStart);
            <span class="hljs-keyword">if</span> (bit) {
              validParts.push(bit[<span class="hljs-number">1</span>]);
              notHost.unshift(bit[<span class="hljs-number">2</span>]);
            }
            <span class="hljs-keyword">if</span> (notHost.length) {
              rest = notHost.join(<span class="hljs-string">'.'</span>) + rest;
            }
            <span class="hljs-keyword">this</span>.hostname = validParts.join(<span class="hljs-string">'.'</span>);
            <span class="hljs-keyword">break</span>;
          }
        }
      }
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hostname.length &gt; hostnameMaxLen) {
      <span class="hljs-keyword">this</span>.hostname = <span class="hljs-string">''</span>;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>strip [ and ] from the hostname
the host field still retains them, though</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (ipv6Hostname) {
      <span class="hljs-keyword">this</span>.hostname = <span class="hljs-keyword">this</span>.hostname.substr(<span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.hostname.length - <span class="hljs-number">2</span>);
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>chop off from the tail first.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> hash = rest.indexOf(<span class="hljs-string">'#'</span>);
  <span class="hljs-keyword">if</span> (hash !== <span class="hljs-number">-1</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>got a fragment string.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.hash = rest.substr(hash);
    rest = rest.slice(<span class="hljs-number">0</span>, hash);
  }
  <span class="hljs-keyword">var</span> qm = rest.indexOf(<span class="hljs-string">'?'</span>);
  <span class="hljs-keyword">if</span> (qm !== <span class="hljs-number">-1</span>) {
    <span class="hljs-keyword">this</span>.search = rest.substr(qm);
    rest = rest.slice(<span class="hljs-number">0</span>, qm);
  }
  <span class="hljs-keyword">if</span> (rest) { <span class="hljs-keyword">this</span>.pathname = rest; }
  <span class="hljs-keyword">if</span> (slashedProtocol[lowerProto] &amp;&amp;
      <span class="hljs-keyword">this</span>.hostname &amp;&amp; !<span class="hljs-keyword">this</span>.pathname) {
    <span class="hljs-keyword">this</span>.pathname = <span class="hljs-string">''</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

Url.prototype.parseHost = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">host</span>) </span>{
  <span class="hljs-keyword">var</span> port = portPattern.exec(host);
  <span class="hljs-keyword">if</span> (port) {
    port = port[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (port !== <span class="hljs-string">':'</span>) {
      <span class="hljs-keyword">this</span>.port = port.substr(<span class="hljs-number">1</span>);
    }
    host = host.substr(<span class="hljs-number">0</span>, host.length - port.length);
  }
  <span class="hljs-keyword">if</span> (host) { <span class="hljs-keyword">this</span>.hostname = host; }
};

<span class="hljs-built_in">module</span>.exports = urlParse;

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
