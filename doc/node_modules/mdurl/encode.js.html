<!DOCTYPE html>
<html>
<head>
  <title>encode.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\mdurl\\encode.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>encode.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">
'use strict'</span>;


<span class="hljs-keyword">var</span> encodeCache = {};


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Create a lookup array where anything but characters in <code>chars</code> string
and alphanumeric chars is percent-encoded.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getEncodeCache</span>(<span class="hljs-params">exclude</span>) </span>{
  <span class="hljs-keyword">var</span> i, ch, cache = encodeCache[exclude];
  <span class="hljs-keyword">if</span> (cache) { <span class="hljs-keyword">return</span> cache; }

  cache = encodeCache[exclude] = [];

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">128</span>; i++) {
    ch = <span class="hljs-built_in">String</span>.fromCharCode(i);

    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^[0-9a-z]$/i</span>.test(ch)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>always allow unencoded alphanumeric characters</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      cache.push(ch);
    } <span class="hljs-keyword">else</span> {
      cache.push(<span class="hljs-string">'%'</span> + (<span class="hljs-string">'0'</span> + i.toString(<span class="hljs-number">16</span>).toUpperCase()).slice(<span class="hljs-number">-2</span>));
    }
  }

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; exclude.length; i++) {
    cache[exclude.charCodeAt(i)] = exclude[i];
  }

  <span class="hljs-keyword">return</span> cache;
}


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Encode unsafe characters with percent-encoding, skipping already
encoded sequences.</p>
<ul>
<li>string       - string to encode</li>
<li>exclude      - list of characters to ignore (in addition to a-zA-Z0-9)</li>
<li>keepEscaped  - don't encode '%' in a correct escape sequence (default: true)</li>
</ul>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encode</span>(<span class="hljs-params">string, exclude, keepEscaped</span>) </span>{
  <span class="hljs-keyword">var</span> i, l, code, nextCode, cache,
      result = <span class="hljs-string">''</span>;

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exclude !== <span class="hljs-string">'string'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>encode(string, keepEscaped)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    keepEscaped  = exclude;
    exclude = encode.defaultChars;
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> keepEscaped === <span class="hljs-string">'undefined'</span>) {
    keepEscaped = <span class="hljs-literal">true</span>;
  }

  cache = getEncodeCache(exclude);

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, l = string.length; i &lt; l; i++) {
    code = string.charCodeAt(i);

    <span class="hljs-keyword">if</span> (keepEscaped &amp;&amp; code === <span class="hljs-number">0x25</span> <span class="hljs-comment">/* % */</span> &amp;&amp; i + <span class="hljs-number">2</span> &lt; l) {
      <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^[0-9a-f]{2}$/i</span>.test(string.slice(i + <span class="hljs-number">1</span>, i + <span class="hljs-number">3</span>))) {
        result += string.slice(i, i + <span class="hljs-number">3</span>);
        i += <span class="hljs-number">2</span>;
        <span class="hljs-keyword">continue</span>;
      }
    }

    <span class="hljs-keyword">if</span> (code &lt; <span class="hljs-number">128</span>) {
      result += cache[code];
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-keyword">if</span> (code &gt;= <span class="hljs-number">0xD800</span> &amp;&amp; code &lt;= <span class="hljs-number">0xDFFF</span>) {
      <span class="hljs-keyword">if</span> (code &gt;= <span class="hljs-number">0xD800</span> &amp;&amp; code &lt;= <span class="hljs-number">0xDBFF</span> &amp;&amp; i + <span class="hljs-number">1</span> &lt; l) {
        nextCode = string.charCodeAt(i + <span class="hljs-number">1</span>);
        <span class="hljs-keyword">if</span> (nextCode &gt;= <span class="hljs-number">0xDC00</span> &amp;&amp; nextCode &lt;= <span class="hljs-number">0xDFFF</span>) {
          result += <span class="hljs-built_in">encodeURIComponent</span>(string[i] + string[i + <span class="hljs-number">1</span>]);
          i++;
          <span class="hljs-keyword">continue</span>;
        }
      }
      result += <span class="hljs-string">'%EF%BF%BD'</span>;
      <span class="hljs-keyword">continue</span>;
    }

    result += <span class="hljs-built_in">encodeURIComponent</span>(string[i]);
  }

  <span class="hljs-keyword">return</span> result;
}

encode.defaultChars   = <span class="hljs-string">";/?:@&amp;=+$,-_.!~*'()#"</span>;
encode.componentChars = <span class="hljs-string">"-_.!~*'()"</span>;


<span class="hljs-built_in">module</span>.exports = encode;

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
